define("kotenei/ajax",["jquery","kotenei/loading","kotenei/popTips","kotenei/validate","kotenei/validateTooltips"],function($,Loading,popTips,Validate,ValidateTooltips){var Ajax=function(){function init(){var ajax=function(type,url,data,config){var config=$.extend({},{loadingEnable:!0,popTips:{delay:800,custom:!1}},config),dtd=$.Deferred();return config.loadingEnable&&Loading.show(),$.ajax({url:url,type:type,data:data||{},dataType:"json",traditional:!0,cache:!1}).done(function(ret){if("string"==typeof ret)try{ret=eval("("+ret+")")}catch(e){return dtd.resolve(ret),dtd.promise()}ret.Status?ret.Message?config.popTips.custom?(popTips.success(ret.Message,config.popTips.delay),ret.Url?window.location.href=ret.Url:dtd.resolve(ret)):popTips.success(ret.Message,config.popTips.delay,function(){ret.Url?window.location.href=ret.Url:dtd.resolve(ret)}):ret.Url?window.location.href=ret.Url:dtd.resolve(ret):ret.ErrorMessage?config.popTips.custom?(popTips.error(ret.ErrorMessage||"发生了未知错误",config.popTips.delay),ret.Url?window.location.href=ret.url:dtd.resolve(ret)):popTips.error(ret.ErrorMessage||"发生了未知错误",config.popTips.delay,function(){ret.Url?window.location.href=ret.url:dtd.resolve(ret)}):ret.Url?window.location.href=ret.Url:dtd.resolve(ret)}).fail(function(){popTips.error("服务器发生错误",config.popTips.delay)}).always(function(){config.loadingEnable&&Loading.hide()}),dtd.promise()};return{post:function(t,e,i){return ajax("POST",t,e,i)},get:function(t,e,i){return ajax("GET",t,e,i)},ajaxForm:function(t,e){var i,s,o,n;(!(t instanceof $)&&t instanceof Validate||t instanceof ValidateTooltips)&&(i=t,t=t.$form),s=t.attr("action"),o=t.attr("method"),n=t.serialize();var a=$.Deferred(),h={Status:!1,ErrorMessage:"验证失败"};return i&&i.valid?i.valid()?ajax(o,s,n,e):(a.reject(h),a.promise()):t.valid?t.valid()?ajax(o,s,n,e):(a.reject(h),a.promise()):ajax(o,s,n,e)}}}var _instance;return{getInstance:function(){return _instance||(_instance=init()),_instance}}}();return Ajax.getInstance()}),define("kotenei/app",["jquery","kotenei/router","kotenei/util","kotenei/popTips","kotenei/loading","kotenei/event"],function(t,e,i){var s=function(e,i){this.$el=e,this._route={},this.config=t.extend({idPrefx:"app-view-",viewClass:"app-view",animateClass:"animated bounceInRight",Template:null},i||{}),this._view={},this.viewId=-1,this.window=window};return s.prototype.route=function(t,e,i){return i||(i=e,e=null),this._route[t]=[e,i],this},s.prototype.run=function(){var t=this,i=new e;for(var s in t._route)!function(e){var s=t._route[e];i.map(e,s[0],function(e){t.callView(s[1],e||{})})}(s);i.init()},s.prototype.callView=function(e,i){var s,o,n=this,a=!1,h=this.window.location.hash;if(this._view[e]?(s=this._view[e].$el,o=this._view[e].hash):(s=t('<div id="'+this.config.idPrefx+ ++this.viewId+'" class="'+this.config.viewClass+'"></div>'),o=h,this._view[e]={$el:s,params:i,hash:o,instance:null},this.$el.append(s),a=!0),o!=h||a){this._view[e].hash=h;var r=this._view[e].instance;require([e],function(t){r||(r=new t(s,n),n._view[e].instance=r),r.run(i)})}this.viewName&&this._view[this.viewName].$el.hide().removeClass(this.config.animateClass),s.show().addClass(this.config.animateClass),this.viewName=e},s.View=function(t,e){this.$el=t,this.app=e,e.config.Template&&(this.Template=e.config.Template)},s.View.prototype.run=function(t){this.context=t},s.View.extend=function(e){e=t.extend({initialize:function(){}},e||{});var o=function(t,e){s.View.call(this,t,e)};o.prototype=i.createProto(s.View.prototype);for(var n in e)o.prototype[n]=e[n];return o},s}),define("kotenei/autoComplete",["jquery"],function(t){var e={LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ENTER:13},i=function(e,i){this.$element=e,this.options=t.extend({},{url:null,zIndex:1e3,data:[],max:10,width:null,height:null,isBottom:!0,hightLight:!1,formatItem:function(t){return t},callback:{setValue:null}},i),this.tpl='<div class="k-autocomplete"></div>',this.active=0,this.init()};return i.prototype.init=function(){var i=this;this.$listBox=t(this.tpl).hide().appendTo(document.body),this.data=this.options.data||[],this.$element.on("keyup",function(s){var o=t(this),n=t.trim(o.val());switch(i.cache?i.cache!=n&&(i.cache=n,i.search(n),i.active=0):(i.cache=n,i.search(n),i.active=0),s.keyCode){case e.UP:case e.LEFT:s.preventDefault(),i.prev();break;case e.DOWN:case e.RIGHT:i.next();break;case e.ENTER:case e.TAB:i.select()}}),this.$listBox.on("click","li",function(){var e=t(this).text();if(i.$element.val(e).focus(),t.isFunction(i.options.callback.setValue)){var s=i.getItem(e);i.options.callback.setValue(s)}}),t(document).on("click.autocomplete",function(){i.hide()}),t(window).on("resize.autocomplete",function(){i.setCss()})},i.prototype.search=function(e){var i=this;if(this.options.url)t.ajax({mode:"abort",type:"GET",url:this.options.url,cache:!1,data:{keyword:e}}).done(function(t){if(t&&t instanceof Array){var s;i.data=t,s=i.getData(e),i.build(e,s),i.show()}});else if(this.options.proxy)this.options.proxy(e,function(t){i.data=t,t=i.getData(e),i.build(e,t),i.show()});else{var s=this.getData(e);this.build(e,s),this.show()}},i.prototype.getData=function(t){this.cacheData=[];var e=[],i=0;if(0===t.length)return e;for(var s,o=0;o<this.data.length;o++)if(s=this.options.formatItem(this.data[o]),s.toLowerCase().indexOf(t.toLowerCase())>=0){if(this.cacheData.push(this.data[o]),e.push(s),i===this.options.max-1)break;i++}return e},i.prototype.build=function(t,e){if(this.$listBox.find("ul").remove(),this.$listItem=null,0!==e.length){for(var i="<ul>",s=0;s<e.length;s++)i+='<li class="'+(0==s?"active":"")+'">'+this.hightLight(t,e[s])+"</li>";i+="</ul>",this.$listBox.append(i),this.$list=this.$listBox.find("ul"),this.$listItem=this.$listBox.find("li")}},i.prototype.hightLight=function(t,e){if(this.options.hightLight){var i=new RegExp("("+t+")","ig");return e=e.replace(i,"<strong>$1</strong>")}return e},i.prototype.show=function(){return this.hasItem()?(this.setCss(),void this.$listBox.show()):void this.hide()},i.prototype.getCss=function(){var t={left:this.$element.offset().left,top:this.$element.outerHeight()+this.$element.offset().top,width:this.options.width||this.$element.outerWidth()};return this.options.isBottom||(t.top=this.$element.offset().top-this.$listBox.outerHeight(!0)),t},i.prototype.setCss=function(){this.$list.css("max-height",this.options.height||"auto");var t=this.getCss();this.$listBox.css(t)},i.prototype.hide=function(){this.$listBox.hide()},i.prototype.prev=function(){this.moveSelect(-1)},i.prototype.next=function(){this.moveSelect(1)},i.prototype.hasItem=function(){return this.$listItem&&this.$listItem.length>0},i.prototype.moveSelect=function(t){if(this.hasItem()){this.active+=t,this.active<0?this.active=this.$listItem.length-1:this.active>this.$listItem.length-1&&(this.active=0);var e=this.$listItem.removeClass("active").eq(this.active).addClass("active"),i=0;this.$listItem.each(function(){i+=this.offsetHeight});var s=this.$list.scrollTop(),o=this.$list[0].clientHeight,n=e.height(),a=e.position().top;a>o?this.$list.scrollTop(a+n-o+s):0>a&&this.$list.scrollTop(s+a)}},i.prototype.select=function(){var e=this.$listBox.find("li.active"),i=e.text();if(this.$element.val(i),this.hide(),t.isFunction(this.options.callback.setValue)){var s=this.getItem(i);this.options.callback.setValue(s)}},i.prototype.getItem=function(t){var e=this.cacheData;if(e&&0!==e.length){for(var i,s=0;s<e.length;s++)if(i=this.options.formatItem(e[s]),t===i)return e[s];return null}},i}),define("kotenei/cache",[],function(){var t={},e=window.localStorage;return t.set=function(i,s,o){if(!s)return void t.remove(i);var n;/^[1-9]\d*$/.test(o)&&(n=(new Date).getTime()+1e3*parseInt(o));var a={value:s,expired:n};e.setItem(i,JSON.stringify(a))},t.get=function(i){var s=e.getItem(i),o=null;return s&&(s=JSON.parse(s),s.expired&&(new Date).getTime()>s.expired?t.remove(i):o=s.value),o},t.remove=function(t){e.removeItem(t)},t.clear=function(){e.clear()},t}),define("kotenei/clipZoom",["jquery","kotenei/dragdrop"],function(t,e){var i=function(e,i){this.$element=e,this.options=t.extend({},{imgUrl:"",scale:!0,width:400,height:300,selectorWidth:120,selectorHeight:100,callback:{clip:null}},i),this.$selector=e.find(".selector"),this.$clipZoomBox=e.find(".k-clipZoom-Box").width(this.options.width).height(this.options.height),this.$container=this.$clipZoomBox.find(".container"),this.$mainImg=this.$container.find("img"),this.$viewBox=e.find(".view-box"),this.$viewImg=this.$viewBox.find("img"),this.$resultBox=e.find(".result-box"),this.$resultImg=this.$resultBox.find("img"),this.init()};return i.prototype.init=function(){var t=this;this.$selector.width(this.options.selectorWidth).height(this.options.selectorHeight),this.$viewBox.width(this.options.selectorWidth).height(this.options.selectorHeight),this.selectorDnd=new e({$layer:this.$selector,$range:this.$clipZoomBox,resizable:!0,scale:this.options.scale,callback:{resize:function(){t.setPreview()},move:function(){t.setPreview()}}}),this.imgLoad(),this.eventBind()},i.prototype.eventBind=function(){var t=this;this.$element.on("click",'[role="clip"]',function(){t.clip()}).on("click",'[role="center"]',function(){t.center()}).on("click",'[role="reset"]',function(){t.reset()}).on("click",'[role="plus"]',function(){t.zoom(!0)}).on("click",'[role="minus"]',function(){t.zoom(!1)})},i.prototype.setImgSize=function(t,e){this.$mainImg.width(t).height(e)},i.prototype.imgLoad=function(){var t=this,i=new Image;i.onload=function(){var s=t.getSize(i.width,i.height,t.options.width);i.width<t.options.width&&(s.width=i.width,s.height=i.height),t.$container.width(s.width).height(s.height).css({left:0,top:0}),t.$mainImg.attr("src",t.options.imgUrl).width(s.width).height(s.height),t.$viewImg.attr("src",t.options.imgUrl).width(s.width).height(s.height),t.resetSize={width:s.width,height:s.height,left:0,top:0},t.containerDnd=new e({$layer:t.$container,$range:t.$clipZoomBox,resizable:!0,boundary:!0,scale:!0,callback:{resize:function(e){t.setImgSize(e.width,e.height),t.setPreview()},move:function(){t.setPreview()}}}),t.setPreview()},i.onerr=function(){alert("图片加载失败")},i.src=this.options.imgUrl},i.prototype.getSize=function(t,e,i){var s;return t>=e?(s=t/e,e=i/s):(s=e/t,e=i*s),{width:parseInt(i),height:parseInt(e)}},i.prototype.zoom=function(t){var e,i=this.$container.width(),s=this.$container.height();e=t?i/.8:.8*i;var o=this.getSize(i,s,e);this.$container.width(o.width).height(o.height),this.$mainImg.width(o.width).height(o.height),this.$viewImg.width(o.width).height(o.height),this.setPreview()},i.prototype.clip=function(){var e={imgSource:this.options.imgUrl,imgWidth:this.$viewImg.width(),imgHeight:this.$viewImg.height(),imgX:Math.abs(this.$viewImg[0].style.marginLeft.replace("px",""))-this.$viewImg.position().left,imgY:Math.abs(this.$viewImg[0].style.marginTop.replace("px",""))-this.$viewImg.position().top,selectorX:this.$selector.position().left,selectorY:this.$selector.position().top,cutterWidth:this.options.selectorWidth,cutterHeight:this.options.selectorHeight};t.isFunction(this.options.callback.clip)&&this.options.callback.clip(e)},i.prototype.center=function(){var t=parseInt(this.$mainImg.width()),e=parseInt(this.$mainImg.height()),i=parseInt(this.$selector.width()),s=parseInt(this.$selector.height()),o=parseInt(this.options.width),n=parseInt(this.options.height),a=this.getSize(t,e,i);a.height<s&&(a.width=t/e*s,a.height=s),this.$mainImg.width(a.width).height(a.height),this.$viewImg.width(a.width).height(a.height),this.$container.width(a.width).height(a.height).css({top:(n-a.height)/2,left:(o-a.width)/2}),this.$selector.css({top:(n-s)/2,left:(o-i)/2}),this.setPreview()},i.prototype.reset=function(){this.$container.width(this.resetSize.width).height(this.resetSize.height).css({left:0,top:0}),this.$mainImg.width(this.resetSize.width).height(this.resetSize.height),this.$viewImg.width(this.resetSize.width).height(this.resetSize.height),this.setPreview()},i.prototype.setPreview=function(){{var t=this.options,e=this.getPreviewInfo(),i=t.selectorWidth,s=t.selectorHeight;e.viewPortWidth,e.viewPortHeight}if(e.selectorWidth>0){var o=i/e.selectorWidth,n=s/e.selectorHeight;this.$viewImg.css({width:Math.round(o*e.imgWidth),height:Math.round(n*e.imgHeight),left:Math.round(o*e.imgX),top:Math.round(n*e.imgY),marginLeft:-Math.round(o*e.selectorX),marginTop:-Math.round(n*e.selectorY)})}},i.prototype.getPreviewInfo=function(){var t=this.options;return{imgWidth:this.$mainImg.width(),imgHeight:this.$mainImg.height(),imgX:this.$container.position().left,imgY:this.$container.position().top,selectorWidth:this.$selector.width(),selectorHeight:this.$selector.height(),selectorX:this.$selector.position().left,selectorY:this.$selector.position().top,viewPortWidth:t.width,viewPortHeight:t.height}},i}),define("kotenei/datepicker",["jquery"],function(t){var e={months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一","十二"],days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["周日","周一","周二","周三","周四","周五","周六"],daysMin:["日","一","二","三","四","五","六"]},i=new Date,s=function(e,s){var o=this;this.$element=e,this.options=t.extend({},{appendTo:t(document.body),showTime:!1,year:{min:i.getFullYear()-100,max:i.getFullYear()+100},format:"yyyy-MM-dd",positionProxy:function(){return o.getPosition()},minDate:null,maxDate:null,zIndex:2e3},s),this.isInput=this.$element.is("input"),this.year=i.getFullYear(),this.month=i.getMonth()+1,this.day=i.getDate(),this.index=0,this.isSetTime=!1,this.selectDay=!1,this.init(),this.event={selected:[],clean:[]}};return s.prototype.on=function(e,i){return t.isArray(this.event[e])&&this.event[e].push(i),this},s.prototype.getPosition=function(){var t={left:0,top:0},e=this.options.appendTo[0],i=this.$element[0];do t.left+=i.offsetLeft-i.scrollLeft,t.top+=i.offsetTop-i.scrollTop;while((i=i.offsetParent)&&i!=e);return{left:t.left,top:t.top+this.$element[0].offsetHeight+2,zIndex:this.options.zIndex}},s.prototype.init=function(){this.isInput&&this.$element.attr("readonly","readonly"),this.initMinMaxDate(),this.canBuild()?(this.createPanel(),this.eventBind()):console.log("最大日期必须大于最小日期")},s.prototype.initMinMaxDate=function(){var t=new Date;this.options.minDate&&(this.minDate="today"===this.options.minDate?t:new Date(this.options.minDate.replace(/-/g,"/")),this.options.year.min=this.minDate.getFullYear()),this.options.maxDate&&(this.maxDate="today"===this.options.maxDate?t:new Date(this.options.maxDate.replace(/-/g,"/")),this.options.year.max=this.maxDate.getFullYear()),this.maxDate&&this.format(this.maxDate,"yyyyMMdd")<this.format(t,"yyyyMMdd")?(this.year=this.maxDate.getFullYear(),this.month=this.maxDate.getMonth()+1,this.day=this.maxDate.getDate()):this.minDate&&this.format(this.minDate,"yyyyMMdd")>this.format(t,"yyyyMMdd")&&(this.year=this.minDate.getFullYear(),this.month=this.minDate.getMonth()+1,this.day=this.minDate.getDate())},s.prototype.canBuild=function(){return this.maxDate&&this.minDate&&this.format(this.maxDate,"yyyyMMdd")<this.format(this.minDate,"yyyyMMdd")?!1:!0},s.prototype.eventBind=function(){var e=this;this.$element.on("click.datepicker",function(){return e.show(),!1}),this.$datepicker.on("click",function(i){var s=i.target,o=t(s);return"year"===s.id||"month"===s.id||o.parents(".year-box:eq(0)").length>0||o.parents(".month-box:eq(0)").length>0?!1:(e.yearBoxToggle(!1),e.monthBoxToggle(!1),e.timePanelHide(),!1)}).on("click","[role=prev]",function(){e.month--,e.prevToggle(),e.month<1&&(e.month=12,e.year--),e.$next.show(),e.createDays()}).on("click","[role=next]",function(){e.month++,e.nextToggle(),e.month>12&&(e.month=1,e.year++),e.$prev.show(),e.createDays()}).on("click","#month",function(){e.monthBoxToggle(!0),e.yearBoxToggle(!1),e.timePanelHide()}).on("click",".month-box li",function(){var i=t(this),s=i.attr("data-month");i.hasClass("disabled")||(e.month=Number(t.trim(s)),e.monthBoxToggle(!1),e.createDays(),e.prevToggle(),e.nextToggle())}).on("click","#year",function(){e.yearBoxToggle(!0),e.monthBoxToggle(!1),e.timePanelHide()}).on("click",".year-box li",function(){var i=t(this),s=Number(t.trim(i.text()));i.hasClass("cur")||i.hasClass("disabled")||(e.$yearBox.find("li").removeClass("cur"),i.addClass("cur"),e.year=Number(s),e.createDays(),e.yearBoxToggle(!1),e.prevToggle(),e.nextToggle())}).on("click","[role=yearPrev]",function(){0!==e.index&&(e.index--,e.toCurYearPanel())}).on("click","[role=yearNext]",function(){e.index!==e.$yearItems.length-1&&(e.index++,e.toCurYearPanel())}).on("click","[role=clear]",function(){e.isInput?e.$element.val(""):e.$element.data("value",""),e.isSetTime=!1,e.setTodayInfo(),e.createDays(),e.setViewInfo(),e.hide(),t.map(e.event.clean,function(t){t()})}).on("click","[role=today]",function(){e.setTodayInfo(),e.createDays(),e.hide(),e.set(!0),e.setTime()}).on("click","tbody td",function(){var i=t(this),s=i.attr("data-year"),o=i.attr("data-month"),n=i.attr("data-day");i.hasClass("disabled")||(s=Number(s),o=Number(o),n=Number(n),e.year=s,e.month=o,e.day=n,e.createDays(),e.options.showTime||(e.set(),e.hide()))}).on("click","span.hours",function(){return e.setTimePanelPosition(t(this),e.$hoursBox),!1}).on("click","span.minutes",function(){return e.setTimePanelPosition(t(this),e.$minutesBox),!1}).on("click","span.seconds",function(){return e.setTimePanelPosition(t(this),e.$secondsBox),!1}).on("click",".time-box li",function(){var i=t(this),s=i.attr("data-value"),o=i.text(),n=i.attr("data-target");switch(n){case"hours":e.hours=s,e.$hours.text(o);break;case"minutes":e.minutes=s,e.$minutes.text(o);break;case"seconds":e.seconds=s,e.$seconds.text(o)}}).on("click","[role=confirm]",function(){var t=e.$datepicker.find("td span.active"),i=t.parent(),s=i.attr("data-year"),o=i.attr("data-month"),n=i.attr("data-day");e.isSetTime=!0,e.year=Number(s),e.month=Number(o),e.day=Number(n),e.hours=Number(e.$hours.text()),e.minutes=Number(e.$minutes.text()),e.seconds=Number(e.$seconds.text()),e.set(),e.hide()}),t(document).on("click.datepicker",function(){e.hide()})},s.prototype.createPanel=function(){var i,s=[];for(s.push('<div class="k-datepicker">'),s.push('<div class="container">'),s.push("<table>"),s.push("<thead>"),s.push("<tr>"),s.push('<th class="prev"  style="width:28px;"><i class="fa fa-chevron-left" role="prev"></i></th>'),s.push('<th colspan="5">'),s.push('<span id="year" style="margin-right:20px;">'+this.year+"</span>"),s.push('<span id="month">'+e.months[this.month-1]+"</span>"),s.push("</th>"),s.push('<th class="next"  style="width:28px;"><i class="fa fa-chevron-right" role="next"></i></th>'),s.push("</tr>"),s.push("<tr>"),i=0;i<e.daysMin.length;i++)s.push("<th>"+e.daysMin[i]+"</th>");s.push("</tr>"),s.push("</thead>"),s.push("<tbody>"),s.push("</tbody>"),s.push("</table>"),s.push(this.getYearBox()),s.push(this.getMonthBox()),s.push('<div class="line"></div>'),s.push(this.getTimeBox()),s.push('<div style="text-align:right;margin-bottom:5px;">'),s.push('<input type="button" value="清空" role="clear" class="k-btn k-btn-default" />&nbsp;');var o='<input type="button" value="今天" role="today" class="k-btn k-btn-success" />&nbsp;';this.minDate&&this.maxDate&&this.format(this.maxDate,"yyyyMMdd")>=this.format(new Date,"yyyyMMdd")||!this.minDate&&!this.maxDate?s.push(o):this.minDate&&!this.maxDate&&this.format(this.minDate,"yyyyMMdd")<=this.format(new Date,"yyyyMMdd")?s.push(o):this.maxDate&&!this.minDate&&this.format(this.maxDate,"yyyyMMdd")>=this.format(new Date,"yyyyMMdd")&&s.push(o),this.options.showTime&&s.push('<input type="button" value="确定" role="confirm" class="k-btn k-btn-primary" />&nbsp;'),s.push("</div>"),s.push("</div>"),s.push("</div>"),this.$datepicker=t(s.join("")),this.$year=this.$datepicker.find("#year"),this.$yearBox=this.$datepicker.find(".year-box"),this.$yearItems=this.$yearBox.find("ul"),this.$month=this.$datepicker.find("#month"),this.$monthBox=this.$datepicker.find(".month-box"),this.$timeBox=this.$datepicker.find(".time-box"),this.$hours=this.$timeBox.find("span.hours"),this.$minutes=this.$timeBox.find("span.minutes"),this.$seconds=this.$timeBox.find("span.seconds"),this.$hoursBox=this.$timeBox.find(".hours-box"),this.$minutesBox=this.$timeBox.find(".minutes-box"),this.$secondsBox=this.$timeBox.find(".seconds-box"),this.$prev=this.$datepicker.find("th.prev i"),this.$next=this.$datepicker.find("th.next i"),this.index=this.$yearItems.find("li.cur").parent().show().index(),this.createDays(),this.options.showTime?this.$timeBox.show():this.$timeBox.hide(),this.$datepicker.appendTo(0==this.options.appendTo.length?document.body:this.options.appendTo)},s.prototype.getYearBox=function(){var t,e,i,s=[],o=[],n=1,a=1,h=this.options.year.max-this.options.year.min+1,r=this.options.year.min-1;t=h%10===0?h/10:Number(h/10)+1;for(e=1;t>=e;e++){for(o.push("<ul>"),i=n;h>=i;i++){if(r+=1,o.push('<li id="li_'+r+'" class="'+(this.year===r?"cur":"")+'" >'+r+"</li>"),n++,a%10===0){a=1;break}a++}o.push("</ul>")}return s.push('<div class="year-box">'),s.push('<div class="year-box-container">'),s.push(o.join("")),s.push("</div>"),s.push('<div class="year-box-controls">'),s.push('<i class="fa fa-chevron-left" style="float:left;" role="yearPrev"></i>'),s.push('<i class="fa fa-chevron-right" style="float:right;" role="yearNext"></i>'),s.push("</div>"),s.push("</div>"),s.join("")},s.prototype.getMonthBox=function(){var t,i,s,o,n=[];for(n.push('<ul class="month-box">'),t=0;t<e.months.length;t++)s=e.months[t],i=t+1,n.push('<li class="'+o+'" data-month="'+(t+1)+'">'+s+"</li>");return n.push("</ul>"),n.join("")},s.prototype.getTimeBox=function(){var t,e=[];for(e.push('<div class="time-box">'),e.push('<ul class="hours-box">'),t=0;24>t;t++)e.push('<li data-target="hours" data-value='+t+">"+this.supStr(t)+"</li>");for(e.push("</ul>"),e.push('<ul class="minutes-box">'),t=0;55>=t;t+=5)e.push('<li data-target="minutes" data-value='+t+">"+this.supStr(t)+"</li>");for(e.push("</ul>"),e.push('<ul class="seconds-box">'),t=0;55>=t;t+=15)e.push('<li data-target="seconds" data-value='+t+">"+this.supStr(t)+"</li>");return e.push("</ul>"),e.push('<div class="time-box-container">'),e.push("<span>时间：</span>"),e.push("<div >"),e.push('<span class="hours">'+i.getHours()+"</span>"),e.push("<span>:</span>"),e.push('<span class="minutes">'+i.getMinutes()+"</span>"),e.push("<span>:</span>"),e.push('<span class="seconds">'+i.getSeconds()+"</span>"),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},s.prototype.createDays=function(t,e,i){function s(t){function e(t){return a.format(t,"yyyyMMdd")<a.format(a.minDate,"yyyyMMdd")?"disabled":""}function i(t){return a.format(t,"yyyyMMdd")>a.format(a.maxDate,"yyyyMMdd")?"disabled":""}if(a.minDate&&a.maxDate){var s=e(t),o=i(t);if(s.length>0)return s;if(o.length>0)return o}else{if(a.minDate)return e(t);if(a.maxDate)return i(t)}return""}var o,n,a=this;this.setSelectivelyDate(),t=t||this.year,e=e||this.month,i=i||this.day;var h=this.getMonthLastDay(t,e),r=this.getMonthLastDay(t,e-1),l=new Date(t,e-1,1).getDay(),d=new Array(42),c=[],p=42-h;for(o=0,n=l;h>o;o++,n++)d[n]={year:t,month:e,day:o+1,tdClass:s(new Date(t,e-1,o+1))},o+1===h&&(p=42-n);for(o=l,n=0;o>=1;o--,n++){var u;1===e?(u=s(new Date(t-1,11,r-o+1)),d[n]={year:t-1,month:12,day:r-o+1,tdClass:"old "+u}):(u=s(new Date(t,e-2,r-o+1)),d[n]={year:t,month:e-1,day:r-o+1,tdClass:"old "+u})}for(o=42-p+1,n=1;42>o;o++,n++){var u;12===e?(u=s(new Date(t+1,0,n)),d[o]={year:t+1,month:1,day:n,tdClass:"new "+u}):(u=s(new Date(t,e,n)),d[o]={year:t,month:e+1,day:n,tdClass:"new "+u})}var f,m,g=0,v=0;for(o=0;6>o;o++){for(c.push("<tr>"),n=g;42>n;n++)if(f=d[n],m=f.year===t&&f.month===e&&this.day===f.day?"today":"",c.push('<td id="'+f.year+"_"+f.month+"_"+f.day+'" class="'+f.tdClass+"   "+m+'  " data-year="'+f.year+'" data-month="'+f.month+'" data-day="'+f.day+'"><span>'+f.day+"</span></td>"),g++,v++,7===v){v=0;break}c.push("</tr>")}this.$datepicker.find("tbody").html(c.join("")),this.setViewInfo(t,e,i)},s.prototype.getMonthLastDay=function(t,e){return new Date(new Date(t,e,1).getTime()-864e5).getDate()},s.prototype.yearBoxToggle=function(t){var e={left:this.$year.position().left,top:this.$year.position().top+this.$year.outerHeight()-2};t?(this.$year.addClass("selected"),this.$yearBox.show().css(e)):(this.$year.removeClass("selected"),this.$yearBox.hide())},s.prototype.monthBoxToggle=function(t){var e={left:this.$month.position().left,top:this.$month.position().top+this.$month.outerHeight()-2};t?(this.$month.addClass("selected"),this.$monthBox.show().css(e)):(this.$month.removeClass("selected"),this.$monthBox.hide())},s.prototype.timePanelHide=function(){this.$hoursBox.hide(),this.$minutesBox.hide(),this.$secondsBox.hide()},s.prototype.toCurYearPanel=function(){this.$yearItems.hide().eq(this.index).show()},s.prototype.prevToggle=function(){var t=1;this.minDate?t=this.minDate.getMonth()+1:this.maxDate&&(t=this.maxDate.getMonth()+1),this.year===this.options.year.min&&this.month===t?this.$prev.hide():this.$prev.show()},s.prototype.nextToggle=function(){var t=12;this.maxDate?t=this.maxDate.getMonth()+1:this.minDate&&(t=this.minDate.getMonth()+1),this.year===this.options.year.max&&this.month===t?this.$next.hide():this.$next.show()},s.prototype.setSelectivelyDate=function(){function e(t){var e=a.minDate.getFullYear(),i=a.minDate.getMonth()+1,o=a.minDate.getDate();e==a.year&&(i>a.month&&(a.month=i,o<a.day&&(a.day=o)),a.month==i&&o>a.day&&(a.day=o),s(t,i))}function i(t){var e=a.maxDate.getFullYear(),i=a.maxDate.getMonth()+1,s=a.maxDate.getDate();e==a.year&&(i<a.month&&(a.month=i,s>a.day&&(a.day=s)),i==a.month&&s<a.day&&(a.day=s),o(t,i))}function s(e,i){e.each(function(){var e=t(this),s=e.attr("data-month");i>s&&e.addClass("disabled")})}function o(e,i){e.each(function(){var e=t(this),s=e.attr("data-month");s>i&&e.addClass("disabled")})}var n=this.$monthBox.find("li").removeClass("disabled"),a=this;this.minDate&&this.maxDate?(e(n),i(n)):this.minDate?e(n):this.maxDate&&i(n)},s.prototype.showInit=function(){var e;if(e=t.trim(this.isInput?this.$element.val():this.$element.data("value")),0!==e.length){var i=/(\d{4}).{1}(\d{2}).{1}(\d{2})/,s=/(\d{2}):(\d{2}):(\d{2})/,o=e.match(i),n=e.match(s);o&&o.length>0&&(this.year=Number(o[1]),this.month=Number(o[2]),this.day=Number(o[3])),n&&n.length>0&&(this.hours=Number(n[1]),this.minutes=Number(n[2]),this.seconds=Number(n[3]))}},s.prototype.show=function(){t("div.k-datepicker").hide(),this.options.showTime&&!this.isSetTime?(this.setTodayInfo(),this.createDays(),this.setViewInfo(),this.setTime()):(this.showInit(),this.createDays(),this.setViewInfo());var e=this.options.positionProxy();this.$datepicker.show().css(e)},s.prototype.hide=function(){this.$datepicker.hide(),this.yearBoxToggle(!1),this.monthBoxToggle(!1),this.timePanelHide()},s.prototype.setTimePanelPosition=function(t,e){var i={left:t.position().left-1,top:t.position().top-e.outerHeight()};e.show().css(i).siblings("ul").hide(),this.yearBoxToggle(!1),this.monthBoxToggle(!1)},s.prototype.setTodayInfo=function(){var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds()},s.prototype.setViewInfo=function(t,i,s){t=t||this.year,i=i||this.month,s=s||this.day,this.prevToggle(),this.nextToggle(),this.$year.html(t),this.$month.html(e.months[i-1]),this.$yearBox.find("li").removeClass("cur"),this.$yearBox.find("#li_"+t).addClass("cur").parent().show().siblings().hide(),this.$datepicker.find("tbody td span").removeClass("active"),this.$datepicker.find("#"+t+"_"+i+"_"+s).children().addClass("active"),this.index=this.$yearItems.find("li.cur").parent().show().index()},s.prototype.setTime=function(){var t=new Date,e=t.getHours(),i=t.getMinutes(),s=t.getSeconds();this.$hours.text(this.supStr(this.isSetTime?this.hours||e:e)),this.$minutes.text(this.supStr(this.isSetTime?this.minutes||i:i)),this.$seconds.text(this.supStr(this.isSetTime?this.seconds||s:s))},s.prototype.set=function(e){e=e||!1,this.isSetTime=!0;var i=new Date,s=e?i.getFullYear():this.year,o=e?i.getMonth():this.month-1,n=e?i.getDate():this.day,a=e||!this.options.showTime?i.getHours():this.hours||i.getHours(),h=e||!this.options.showTime?i.getMinutes():this.minutes||i.getMinutes(),r=e||!this.options.showTime?i.getSeconds():this.seconds||i.getSeconds(),l=new Date(s,o,n,a,h,r),d=this.format(l);this.isInput?this.$element.val(d).focus().blur():this.$element.data("value",d),t.map(this.event.selected,function(t){t(d)})},s.prototype.format=function(t,e){t=t||new Date;var i,s,e=e||this.options.format.replace(/"/g,""),o={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(i in o)new RegExp("("+i+")").test(e)&&(s=o[i],e=e.replace(RegExp.$1,1===s.toString().length?"0"+s.toString():s));return e},s.prototype.supStr=function(t){return t=String(t),1===t.length?"0"+t:t},s.Global=function(e){e=e||t(document.body).find('input[data-module="datepicker"]'),e.each(function(){var e=t(this),i=e.attr("data-format"),o=e.attr("data-showTime"),n=e.attr("data-minDate"),a=e.attr("data-maxDate"),h=e.attr("data-appendTo"),r=e.data("datepicker");o=o?"true"===o:!1,r||(r=new s(e,{format:i,showTime:o,minDate:n,maxDate:a,appendTo:t(h||document.body)}),e.data("datepicker",r))})},s}),define("kotenei/dragdrop",["jquery"],function(t){var e=function(e){this.options=t.extend({},{$layer:null,$handle:null,$range:null,direction:"",resizable:!1,scale:!1,boundary:!1,minWidth:100,callback:{start:t.noop,move:t.noop,stop:t.noop,resize:t.noop}},e),this.$layer=e.$layer,this.$handle=e.$handle,this.$range=e.$range,this.$window=t(window),this.$document=t(document),this.isResize=!1,this.moving=!1,this.offset={x:0,y:0},this.originalCoord={x:0,y:0},this.resizeParams={left:0,top:0,width:0,height:0,type:"bottomRight"},this.init()};return e.prototype.init=function(){this.$layer&&(this.$range&&this.$range.css("position","relative"),this.$handle=this.$handle||this.$layer,this.$layer.css({cursor:"move",position:"absolute"}),this.options.resizable&&(this.$layer.append('<span class="k-resizable k-resizable-topLeft" data-type="topLeft"></span>'),this.$layer.append('<span class="k-resizable k-resizable-topRight" data-type="topRight"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomLeft" data-type="bottomLeft"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomRight" data-type="bottomRight"></span>'),this.options.scale||(this.$layer.append('<span class="k-resizable k-resizable-topCenter" data-type="topCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-leftCenter" data-type="leftCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-rightCenter" data-type="rightCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomCenter" data-type="bottomCenter"></span>'))),this.setMinSize(),this.eventBind())},e.prototype.setMinSize=function(){var t,e=this.$layer.outerWidth(),i=this.$layer.outerHeight();this.minWidth=this.options.minWidth||e,e>=i?(t=e/i,this.minHeight=this.minWidth/t):(t=i/e,this.minHeight=this.minWidth*t)},e.prototype.eventBind=function(){var e=this;this.$handle.on("mousedown",function(t){t.stopPropagation(),t.preventDefault(),e.start(t),document.onselectstart=function(){return!1}}).on("mousedown",".k-resizable",function(){e.isResize=!0,e.resizeParams.type=t(this).attr("data-type"),e.resizeParams.left=parseInt(e.$layer.position().left),e.resizeParams.top=parseInt(e.$layer.position().top),e.resizeParams.width=parseInt(e.$layer.outerWidth()),e.resizeParams.height=parseInt(e.$layer.outerHeight()),e.resizeParams.ratio=e.resizeParams.width>=e.resizeParams.height?e.resizeParams.width/e.resizeParams.height:e.resizeParams.height/e.resizeParams.width})},e.prototype.start=function(e){var i=this;this.$document.on("mousemove",function(t){i.isMoving&&(i.isResize?i.resize(t):i.move(t))}).on("mouseup",function(e){i.stop(e),t(this).off()});var s=this.getMouseCoord(e);return this.offset.x=s.x-this.$layer.position().left,this.offset.y=s.y-this.$layer.position().top,this.originalCoord.x=s.x,this.originalCoord.y=s.y,this.$handle[0].setCapture&&this.$handle[0].setCapture(),this.isMoving=!0,t.isFunction(this.options.callback.start)&&this.options.callback.start(e,this.$layer),!1
},e.prototype.move=function(e){var i,s,o=this.getMouseCoord(e),n={x:o.x-this.offset.x,y:o.y-this.offset.y},a=this.$range;a?(i=a.width()-this.$layer.outerWidth(!0),s=a.height()-this.$layer.outerHeight(!0),this.options.boundary||(n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x>i&&(n.x=i),n.y>s&&(n.y=s))):(i=this.$window.width()-this.$layer.outerWidth()+this.$document.scrollLeft(),s=this.$window.height()-this.$layer.outerHeight()+this.$document.scrollTop(),n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x>i&&(n.x=i),n.y>s&&(n.y=s)),this.setPosition(n),t.isFunction(this.options.callback.move)&&this.options.callback.move(n)},e.prototype.resize=function(e){var i,s,o=this.getMouseCoord(e),n={x:o.x-this.offset.x,y:o.y-this.offset.y},a=(this.$layer,this.resizeParams),h={left:0,top:0,width:0,height:0},r=this.$range;switch(r?(i=r.width(),s=r.height()):(i=this.$window.width()+this.$document.scrollLeft(),s=this.$window.height()+this.$document.scrollTop()),this.resizeParams.type){case"topLeft":h.width=a.width+(a.left-n.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.top=a.top-(h.height-a.height),h.left=a.left-(h.width-a.width),h.left<0&&(h.left=0,h.width=a.width+a.left,h.height=this.getScaleHeight(h.width),h.top=a.top-(h.height-a.height)),h.top<0&&(h.top=0,h.height=a.height+a.top,h.width=this.getScaleWidth(h.height),h.left=a.left-(h.width-a.width));break;case"topRight":h.left=a.left,h.width=a.width-(this.originalCoord.x-o.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.width+h.left>=i&&(h.width=i-a.left,h.height=this.getScaleHeight(h.width)),h.top=a.top-(h.height-a.height),h.top<0&&(h.top=0,h.height=a.height+a.top,h.width=this.getScaleWidth(h.height));break;case"leftCenter":h.top=a.top,h.height=a.height,n.x<=0?(h.left=0,h.width=a.width+a.left):(h.left=n.x,h.width=a.width+(this.originalCoord.x-o.x)),h.width<=this.minWidth&&(h.width=this.minWidth,h.left=a.left+(a.width-h.width));break;case"rightCenter":h.top=a.top,h.left=a.left,h.height=a.height,h.width=a.width-(this.originalCoord.x-o.x),h.width+h.left>=i&&(h.width=i-a.left),h.width<=this.minWidth&&(h.width=this.minWidth);break;case"topCenter":h.top=n.y,h.left=a.left,h.width=a.width,h.height=a.height+(this.originalCoord.y-o.y),n.y<0&&(h.top=0,h.height=a.height+a.top),h.height<=this.minHeight&&(h.height=this.minHeight,h.top=a.top+(a.height-h.height));break;case"bottomCenter":h.top=a.top,h.left=a.left,h.width=a.width,h.height=a.height-(this.originalCoord.y-o.y),h.height+h.top>=s&&(h.height=s-a.top),h.height<=this.minHeight&&(h.height=this.minHeight);break;case"bottomLeft":h.top=a.top,h.width=a.width+(this.originalCoord.x-o.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.left=a.left-(h.width-a.width),h.left<=0&&(h.left=0,h.width=a.width+a.left,h.height=this.getScaleHeight(h.width)),h.height+h.top>=s&&(h.height=s-h.top,h.width=this.getScaleWidth(h.height),h.left=a.left-(h.width-a.width));break;case"bottomRight":h.top=a.top,h.left=a.left,h.width=a.width-(this.originalCoord.x-o.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.width+h.left>=i&&(h.width=i-a.left,h.height=this.getScaleHeight(h.width)),h.top+h.height>=s&&(h.height=s-h.top,h.width=this.getScaleWidth(h.height))}this.$layer.css(h),t.isFunction(this.options.callback.resize)&&this.options.callback.resize(h)},e.prototype.getScaleWidth=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t*e:t/e},e.prototype.getScaleHeight=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t/e:t*e},e.prototype.stop=function(e){this.isMoving=!1,this.isResize=!1,this.$handle[0].releaseCapture&&this.$handle[0].releaseCapture(),t.isFunction(this.options.callback.stop)&&this.options.callback.stop(e,this.$layer)},e.prototype.getMouseCoord=function(t){return{x:t.pageX||t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.pageY||t.clientY+document.body.scrollTop-document.body.clientTop}},e.prototype.setPosition=function(t){"h"===this.options.direction?this.$layer.css("left",t.x):"v"===this.options.direction?this.$layer.css("top",t.y):this.$layer.css({left:t.x,top:t.y})},e}),define("kotenei/dropdown",["jquery"],function(t){var e=t("body"),i=t(document),s=0,o=function(e,i){this.$soure=e,this.setting=t.extend({width:e.width(),height:e.height()},i||{}),e.data("widget",this),s++,this.id=s,this.nameSpace="dropdown_"+String(this.id),this.initDom()};return o.prototype.initDom=function(){var e=this.$soure.parent();this.$soure.css({visibility:"hidden"}),"static"===e.css("position")&&e.css({visibility:"relative"});var i=1;"auto"===this.$soure.css("zIndex")?this.$soure.css("zIndex",1):i=Number(this.$soure.css("zIndex")),this.$el=t('<div class="widget-dropbox"/>').css({width:this.setting.width,height:this.setting.height,zIndex:i+1}),this.$label=t('<div class="label"/>').css({width:this.setting.width-this.setting.height,height:this.setting.height,lineHeight:String(this.setting.height-4)+"px"}).appendTo(this.$el),this.$icon=t('<div class="ic">&#9660;</div>').css({width:this.setting.height,height:this.setting.height,lineHeight:String(this.setting.height)+"px"}).appendTo(this.$el),this.buildDrop(),this.$el.insertBefore(this.$soure),this.watch()},o.prototype.syncPosition=function(){this.$el.css(this.$soure.position())},o.prototype.setLabel=function(t){this.$label.text(t).attr("title",t)},o.prototype.getVal=function(){return this.$soure.val()},o.prototype.setVal=function(t){this.$soure.val(t).change()},o.prototype.buildDrop=function(){this.$drop&&this.$drop.remove(),this.$drop=t('<div class="widget-dropbox-drop"/>').css({width:this.setting.width}).hide();var i=[];this.$soure.find("option").each(function(){var e=t(this);i.push('<li data-val="'+e.val()+'">'+e.text()+"</li>")});var s=t("<ul>"+i.join("")+"</ul>");s.appendTo(this.$drop),this.$drop.appendTo(e),this.syncPosition(),this.sync()},o.prototype.sync=function(){var t=this.$soure.find("option:selected").text();if(!t){var e=this.$soure.find("option").eq(0);t=e.text(),this.setVal(e.val())}this.setLabel(t)},o.prototype.showDrop=function(){var e=this,s=e.$el.offset();e.$el.addClass("widget-dropbox-hover"),e.$drop.css({top:s.top+e.setting.height+2,left:s.left}).show(),i.on("click."+e.nameSpace,function(i){i.target!==e.$label[0]&&i.target!==e.$icon[0]&&i.target!==e.$drop[0]&&!1===t.contains(e.$drop[0],i.target)&&e.hideDrop()})},o.prototype.hideDrop=function(){var t=this;t.$drop.hide(),t.$el.removeClass("widget-dropbox-hover"),i.off("click."+t.nameSpace)},o.prototype.watch=function(){var e=this;this.$el.on("click",function(){e.showDrop()}),this.$drop.on("click","li",function(){var i=t(this);return e.setVal(i.data("val")),e.sync(),e.hideDrop(),!1})},o.prototype.reload=function(){this.buildDrop()},o}),define("kotenei/dropdownDatepicker",["jquery","kotenei/dropdown","kotenei/datepicker","kotenei/util"],function(t,e,i,s){var o=function(t,i){e.call(this,t,i)};return o.prototype=s.createProto(e.prototype),o.prototype.buildDrop=function(){var t=this;this.datepicker=new i(t.$el,{format:this.setting.format,showTime:this.setting.showTime||!1}),this.datepicker.on("selected",function(e){t.$el.data("value",e),t.setVal(e),t.setLabel(e)}).on("clean",function(){var e=t.$soure.attr("placeholder")||"选择日期";t.setVal(""),t.setLabel(e),t.$el.data("value",null)}),t.sync()},o.prototype.sync=function(){var t=this.getVal();if(t)this.$el.data("value",t),this.setVal(t),this.setLabel(t);else{var e=this.$soure.attr("placeholder")||"选择日期";this.setLabel(e)}},o.prototype.watch=function(){},o}),define("kotenei/event",[],function(){var t={},e={},i=-1;return t.on=function(t,s){e[t]||(e[t]=[]);var o=(++i).toString();return e[t].push({token:o,func:s}),o},t.off=function(t){if(!t)return i=-1,void(e={});if(/^\d+$/.test(t)){for(var s in e)if(e[s])for(var o=0,n=e[s].length;n>o;o++)if(e[s][o].token===t)return e[s].splice(o,1),t}else e[t]&&delete e[t]},t.trigger=function(t,i){if(!e[t])return!1;for(var s=e[t],o=s?s.length:0;o--;)s[o].func(i)},t}),define("kotenei/highlight",["jquery"],function(t){var e={},i=t(document.body),s="k-highlight";return e.highlightHtml=function(e,s,o){t.isArray(e)&&(o=s,s=e,e=i);var n=this.highlightText(e.html(),s,o);e.html(n)},e.highlightText=function(e,i,o){if(!e||0===e.length)return"";if(e=this.highlightClean(e,o),o=o||s,!i)return e;if(t.isArray(i)||(i=[i]),1===i.length&&0===t.trim(i[0]).length)return e;for(var n=e.match(/[^<>]+|<(\/?)([A-Za-z]+)([^<>]*)>/g),a=0;a<n.length;a++)/<[^>]+>/.test(n[a])||0==t.trim(n[a]).length||(n[a]=n[a].replace(new RegExp("("+i.join("|")+")","ig"),'<mark class="'+o+'">$1</mark>'));return n.join("")},e.highlightClean=function(t,e){e=e||s;var i=new RegExp('<mark class="?'+e+'"?>(.*?)</mark>',"ig");return t=t.replace(i,"$1")},e}),define("kotenei/imgPreview",["jquery","kotenei/loading","kotenei/popTips"],function(t,e,i){var s=function(e,i){this.$elements=e,this.options=t.extend({},{delay:500,showButtons:!0,backdrop:!0,backdropClose:!0,tpl:'<div class="k-imgPreview"><div class="container"><span class="close" role="close"><i class="fa fa-close"></i></span><span class="prev" role="prev"><i class="fa fa-chevron-left"></i></span><span class="next" role="next"><i class="fa fa-chevron-right"></i></span><img src="" /></div><p class="description"></p></div>'},i),this.$win=t(window),this.isLoading=!1,this.index=0,this.init()};return s.prototype.init=function(){0!==this.$elements.length&&(this.$imgPreview=t(this.options.tpl).appendTo(document.body),this.$container=this.$imgPreview.find(".container"),this.$img=this.$container.find("img"),this.$prev=this.$container.find(".prev"),this.$next=this.$container.find(".next"),this.$backdrop=t("<div/>").addClass("k-imgPreview-backdrop").appendTo(document.body),this.$elements.css("cursor","pointer").each(function(e){var i=t(this),s="imgPreview_"+e;this.id=s,i.attr("data-index",e)}),this.eventBind())},s.prototype.eventBind=function(){var e=this;this.$elements.on("click",function(){var i=t(this);e.index=Number(i.attr("data-index")),e.show()}),this.$backdrop.on("click",function(){e.options.backdropClose&&e.hide()}),this.$imgPreview.on("click","[role=close]",function(){e.hide()}).on("click","[role=prev]",function(){0!==e.index&&(e.index--,e.showControls(),e.show())}).on("click","[role=next]",function(){e.index>=e.$elements.length-1||(e.index++,e.showControls(),e.show())}).on("mouseenter",function(){e.showControls()}).on("mouseleave",function(){e.$prev.hide(),e.$next.hide()})},s.prototype.showControls=function(){var t=this.$elements.length;1!==t&&(0===this.index?(this.$prev.hide(),this.$next.show()):this.index>=t-1?(this.$prev.show(),this.$next.hide()):(this.$prev.show(),this.$next.show()))},s.prototype.imgLoad=function(t,e){var s=new Image;s.onload=function(){e(!0,{width:s.width,height:s.height})},s.onerror=function(){i.error("图片加载失败！",1500),e(!1,{width:0,height:0})},s.src=t},s.prototype.getMaxSize=function(){return{width:this.$win.width()-100,height:this.$win.height()-100}},s.prototype.zoom=function(t,e){var i,s,o=this.getMaxSize();return t<o.width&&e<o.height?{width:t,height:e}:(t>=e?(i=t/e,s=o.width/i):(i=e/t,s=o.width*i),nw=o.width,s>o.height&&(s=o.height,nw=t/e*s),{width:nw,height:s})},s.prototype.show=function(){var t,i=this,s=this.$elements.eq(this.index);0!==s.length&&(t=s.attr("data-href")||s.attr("src"),t&&!this.isLoading&&(this.isLoading=!0,e.show(),this.imgLoad(t,function(s,o){s?(i.$img.attr("src",t),i.setPosition(o)):i.hide(),e.hide(),i.isLoading=!1})))},s.prototype.hide=function(){this.$imgPreview.fadeOut(this.options.delay),this.options.backdrop&&this.$backdrop.fadeOut(this.options.delay)},s.prototype.setPosition=function(t){var e=(this.$win.width(),this.$win.height(),t.width),i=t.height,s=this.zoom(e,i);this.$container.css({width:s.width,height:s.height}),this.$imgPreview.hide().css({width:s.width+20,height:s.height+20,marginTop:-((s.height+20)/2),marginLeft:-((s.width+20)/2)}).fadeIn(this.options.delay),this.options.backdrop&&this.$backdrop.fadeIn(this.options.delay)},s}),define("kotenei/infiniteScroll",["jquery"],function(t){var e=function(e){var i=this;this.options=t.extend({},{$scrollElement:t(window),$watchElement:null,scrollDistance:.3,callback:t.noop},e),this.$scrollElement=this.options.$scrollElement,this.$watchElement=this.options.$watchElement,this.$watchElement&&(this.$scrollElement.on("scroll.infiniteScroll",function(){i.scroll()}),this.scroll())};return e.prototype.scroll=function(){var t=this.$scrollElement.height(),e=t+this.$scrollElement.scrollTop(),i=this.$watchElement.offset().top+this.$watchElement.height(),s=i-e,o=s<=t*this.options.scrollDistance;o&&this.options.callback()===!1&&this.destroy()},e.prototype.destroy=function(){this.$scrollElement.off("scroll.infiniteScroll")},e}),define("kotenei/lazyload",["jquery"],function(t){function e(e,i){this.$elements=e,this.options=t.extend({},{placeholder:null,$container:t(window),callback:t.noop},i),this.cache=[],this.init()}return e.prototype.init=function(){var e=this;this.$elements.each(function(){if("img"==this.nodeName.toLowerCase()){var i=t(this),s={};null!=e.options.placeholder&&(this.setAttribute("data-url",this.src),this.src=e.options.placeholder),this.getAttribute("data-url")&&(s.$elm=i,s.url=this.getAttribute("data-url"),e.cache.push(s))}}),0!==this.cache.length&&(this.count=this.cache.length,this.eventBind(),this.load())},e.prototype.eventBind=function(){this.options.$container.on("scroll.lazyload",t.proxy(this.load,this))},e.prototype.load=function(){var e=this,i=this.getPosition();this.count<=0||t.each(this.cache,function(t,s){{var o,n,a=s.$elm,h=s.url;s.tag}a&&(n=a.offset().top,o=[n-i.top,n-i.top+a.height()],(o[0]>=0&&o[0]<i.height||o[1]>0&&o[1]<=i.height)&&(!function(t,i){e.imgLoad(t,i,function(){t.hide().fadeIn(),e.callback(t)})}(a,h),s.$elm=null,e.count--))})},e.prototype.imgLoad=function(t,e,i){var s=new Image;s.onload=function(){t.attr("src",e),i()},s.onerror=function(){i()},s.src=e},e.prototype.getPosition=function(){var t,e={},i=this.options.$container,s=i.height();return t=i[0]===window?i.scrollTop():i.offset().top,e.height=s,e.top=t,e},e.prototype.callback=function(e){t.isFunction(this.options.callback)&&this.options.callback(e)},function(i,s){return i=i||t("img"),new e(i,s)}}),define("kotenei/loading",["jquery","spin"],function(t,e){var i,s=function(e){this.options=t.extend({},{lines:12,length:10,width:4,radius:14,corners:1,rotate:0,direction:1,color:"white",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"70px",left:"70px"},e),this.tpl='<div class="k-loading"></div>',this.init()},o=!1;return s.prototype.init=function(){this.spinner=new e(this.options),this.$loading=t(this.tpl).appendTo(document.body).hide()},s.prototype.show=function(){o||(o=!0,this.spinner.spin(this.$loading.get(0)),this.$loading.fadeIn("fast"))},s.prototype.hide=function(){this.$loading.stop().hide(),this.spinner.stop(),o=!1},s.show=function(){i||(i=new s),i.show()},s.hide=function(){i&&i.hide()},s}),define("kotenei/pager",["jquery","kotenei/event"],function(t,e){var i=function(i,s){this.$element=i,this.options=t.extend({},{curPage:1,totalCount:0,pageSize:20,className:"k-pagination"},s),this.curPage=this.options.curPage,this.totalCount=this.options.totalCount,this.pageSize=this.options.pageSize,this.template='<div class="pager-box"></div>',this.event=e,this.init()};return i.prototype.init=function(){if(0!==this.totalCount){var e=this;this.$pager=t(this.template).append(this.build()).appendTo(this.$element),this.$pager.on("click","li",function(){var i=t(this),s=i.attr("data-page");i.hasClass("disabled")||i.hasClass("active")||(e.curPage=parseInt(s),e.$pager.html(e.build()),e.event.trigger("click.pager",[s]))})}},i.prototype.on=function(t,e){var i=this;this.event.on(t+".pager",function(t){e.apply(i,t)})},i.prototype.build=function(){var t,e=this.getInfo(),i=[];i.push('<ul class="'+this.options.className+'">'),t=this.curPage>1?"":"disabled",i.push('<li class="'+t+'" data-page="'+e.pre+'" ><a href="javascript:void(0);">«</a></li>');for(var s=e.start;s<=e.end;s++)t=s===this.curPage?"active":"",i.push('<li class="'+t+'" data-page="'+s+'" ><a href="javascript:void(0);">'+s+"</a></li>");return t=this.curPage!==e.allPage?"":"disabled",i.push('<li class="'+t+'" data-page="'+e.next+'" ><a href="javascript:void(0);">»</a></li>'),i.push("</ul>"),i.join("")},i.prototype.getInfo=function(){var t,e,i,s,o;return o=parseInt(this.totalCount/this.pageSize),o=this.totalCount%this.pageSize!==0?o+1:o,o=0===o?1:o,t=this.curPage+2>o?o-4:this.curPage-2,e=this.curPage<4?5:this.curPage+2,1>t&&(t=1),e>o&&(e=o),i=this.curPage-1<1?1:this.curPage-1,s=this.curPage+1>o?o:this.curPage+1,{start:t,end:e,pre:i,next:s,allPage:o}},i}),define("kotenei/placeholder",["jquery"],function(t){function e(e){e.each(function(){var e=t(this),s=e.data("placeholder");if(void 0===s){var o=t.trim(e.attr("placeholder"));if(!o||0===o.length)return;s=new i(e),e.data("placeholder",s)}else s.setPosition()})}var i=function(t){this.$elm=t,this.type="placeholder",this.init()};return i.prototype.init=function(){var e=t.trim(this.$elm.attr("placeholder"));this.timer=this.$elm.attr("data-timer"),this.timer&&(this.timer=JSON.stringify(this.timer)),this.$placeholder=t("<div/>").addClass("placeholder").text(e).insertAfter(this.$elm).hide(),this.$elm.parent().css("position","relative"),this.setPosition(),this.eventBind()},i.prototype.eventBind=function(){var e=this;this.timer&&setInterval(function(){e.setPosition()},this.timer.delay),this.$elm.on("focus."+this.type,function(){e.$placeholder.hide()}).on("blur."+this.type,function(){var i=t.trim(e.$elm.val());0===i.length||i===e.text?(e.$elm.val(""),e.$placeholder.show()):e.$placeholder.hide()}),this.$placeholder.on("focus."+this.type,function(){e.$elm.focus()})},i.prototype.display=function(){var e=t.trim(this.$elm.val());0===e.length||e===t.trim(this.$elm.attr("placeholder"))?this.$placeholder.show():this.$placeholder.hide()},i.prototype.setPosition=function(){var t=this;setTimeout(function(){var e={left:t.$elm[0].offsetLeft,top:t.$elm[0].offsetTop,height:t.$elm.outerHeight(),width:t.$elm.outerWidth(),position:"absolute",paddingLeft:"10px",paddingRight:"10px",paddingTop:0,margin:0,lineHeight:t.$elm.outerHeight()+"px",cursor:"text",color:"#999"};"textarea"===t.$elm[0].nodeName.toLowerCase()&&(e.lineHeight="auto",e.paddingTop=5),t.$placeholder.css(e),t.display()},50)},function(i){"placeholder"in document.createElement("input")||(i=i||t("input,textarea"),e(i))}}),define("kotenei/popTips",["jquery"],function(t){var e=function(){function e(){function e(e,n,a,h){o&&clearTimeout(o),t.isFunction(a)&&(h=a,a=3e3),h=h||t.noop,a=a||3e3,s&&s.stop().remove(),s=t(i(e,n)).appendTo(document.body).hide(),s.css({marginLeft:-(s.width()/2),marginTop:-(s.height()/2)}).fadeIn("fase",function(){o=setTimeout(function(){s.stop().remove(),h()},a)})}function i(t,e){var i=[];switch(t){case"success":i.push('<div class="k-pop-tips success"><span class="fa fa-check"></span>&nbsp;<span>'+e+"</span></div>");break;case"error":i.push('<div class="k-pop-tips error"><span class="fa fa-close"></span>&nbsp;<span>'+e+"</span></div>");break;case"warning":i.push('<div class="k-pop-tips warning"><span class="fa fa-exclamation"></span>&nbsp;<span>'+e+"</span></div>")}return i.join("")}var s,o;return{success:function(t,i,s){e("success",t,i,s)},error:function(t,i,s){e("error",t,i,s)},warning:function(t,i,s){e("warning",t,i,s)}}}var i;return{getInstance:function(){return i||(i=e()),i}}}();return e.getInstance()}),define("kotenei/popover",["jquery","kotenei/tooltips","kotenei/util"],function(t,e,i){var s=function(i,s){s=t.extend({},{type:"popover",title:"标题",tpl:'<div class="k-popover"><div class="k-popover-arrow"></div><div class="k-popover-title"></div><div class="k-popover-inner"></div></div>'},s),e.call(this,i,s),this.setTitle()};return s.prototype=i.createProto(e.prototype),s.prototype.setTitle=function(e){e=t.trim(e||this.options.title),0===e.length&&(e=this.$element.attr("data-title")||"");var i=this.$tips;i.find(".k-popover-title").text(e)},s.prototype.setContent=function(e){e=t.trim(e||this.options.content),0===e.length&&(e=this.$element.attr("data-content")||"");var i=this.$tips;i.find(".k-popover-inner").html(e)},s.Global=function(e){var e=e||t('[data-module="popover"]');e.each(function(){var e=t(this),i=s.Get(e);i||(i=new s(e,{title:e.attr("data-title"),content:e.attr("data-content"),placement:e.attr("data-placement"),tipClass:e.attr("data-tipClass"),trigger:e.attr("data-trigger")}),s.Set(e,i))})},s.Get=function(t){return t.data("popover")},s.Set=function(t,e){t.data("popover",e)},s}),function(t){var e={addEventListener:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeEventListener:function(t,e){t.removeEventListener?t.removeEventListener(e,handler,!1):t.detachEvent?t.detachEvent("on"+e,handler):t["on"+e]=null},proxy:function(t,e){var i=function(){return t.apply(e||this,arguments)};return i}},i=function(){this._routes=[]};i.prototype.init=function(){var i=this;e.addEventListener(t,"hashchange",e.proxy(i.listener,this)),this.listener()},i.prototype.listener=function(){var t,e=location.hash.slice(1).split("?"),i=e[0];e[1]&&(t=this.getUrlParams(e[1]));var s,o=this.getRoute(i),n={};if(!o)return void location.replace("#/");s=this.getValues(i,o);for(var a=0;a<o.params.length;a++)n[o.params[a]]=s[a];t=$.extend({},n,t),o.handle(t)},i.prototype.getUrlParams=function(t){var e={};if(!t)return e;for(var i,s=t.split("&"),o=0;o<s.length;o++)i=s[o].split("="),e[i[0]]=i[1];return e},i.prototype.map=function(t,e,i){var s,o,n,a=[];if(o=t.replace(/\//g,"\\/"),"function"==typeof e&&(i=e,e=null),e)for(var h in e)s=new RegExp("\\{"+h+"\\}","g"),o=o.replace(s,"("+e[h].replace(/\^/,"").replace(/\$/,"")+")"),a.push(h);for(s=new RegExp("{([^}]+)}","g");null!=(n=s.exec(o));)a.push(n[1]),s.lastIndex;return o="^"+o.replace(/{[^}]+}/gi,"(.+)")+"$",this._routes.push({routeUrl:t,pattern:o,params:a,handle:i||function(){}}),this},i.prototype.getValues=function(t,e){var e,i=[];if(0===t.length)return i;if(e=e||this.getRoute(t),null!=e){var s=t.match(e.pattern);if(0!=s.length)for(var o=1;o<s.length;o++)i.push(s[o])}return i},i.prototype.getRoute=function(t){for(var e=0;e<this._routes.length;e++)if(new RegExp(this._routes[e].pattern).test(t))return this._routes[e];return null},"function"==typeof t.define&&define.amd?define("kotenei/router",[],function(){return i}):t.Router=i}(window),define("kotenei/slider",["jquery","kotenei/dragdrop"],function(t,e){var i=function(e,i){this.$element=e,this.options=t.extend({},{min:1,max:10,step:1,value:1,$bindElement:t([]),callback:{slide:t.noop}},i),this.template='<div class="k-slider"><div class="k-slider-selection"></div><div class="k-slider-handle"></div></div>',this.min=this.options.min,this.max=this.options.max,this.step=this.options.step,this.diff=this.max-this.min,this.init()};return i.prototype.init=function(){var i=this;this.$slider=t(this.template).appendTo(this.$element),this.$sliderSelection=this.$slider.find("div.k-slider-selection"),this.$sliderHandle=this.$slider.find("div.k-slider-handle"),this.handleWidth=this.$sliderHandle.width(),this.sliderWidth=this.$slider.outerWidth(),this.$bindElement=this.options.$bindElement,this.dragdrop=new e({$range:this.$slider,$layer:this.$slider.find(".k-slider-handle"),direction:"h",callback:{move:function(t){var e=i.getMoveValue(t);i.setValue(e),i.options.callback.slide(e)}}}),this.eventBind(),this.setValue(this.options.value)},i.prototype.eventBind=function(){if(this.allowElement()){var e=this.$bindElement[0].type,i=this;-1!==e.indexOf("select")?this.$bindElement.on("change",function(){var e=t(this),s=t.trim(i.getFilterValue(e.val()));i.setValue(s)}):this.$bindElement.on("keyup",function(e){var s=t(this),o=t.trim(i.getFilterValue(s.val()));13===e.keyCode&&i.setValue(o)})}},i.prototype.allowElement=function(){if(0===this.$bindElement.length)return!1;var t=this.$bindElement[0].type;return"text"!==t&&"textarea"!==t&&-1===t.indexOf("select")?!1:!0},i.prototype.getFilterValue=function(t){return t||(t=this.min),isNaN(t)&&(t=this.min),t<this.min&&(t=this.min),t>this.max&&(t=this.max),t},i.prototype.setValue=function(t){t>this.max&&(t=this.max),t<this.min&&(t=this.min);var e=(t-this.min)/this.diff*100;this.setPercent(e),this.setElementValue(t)},i.prototype.setElementValue=function(t){if(this.allowElement()){var e=this.$bindElement[0].type;-1!=e.indexOf("select")?this.$bindElement.find("option[value='"+t+"']").prop("selected",!0):this.$bindElement.val(t)}},i.prototype.getMoveValue=function(t){var e=t.x/(this.sliderWidth-this.handleWidth)*100,i=Math.round(e/100*this.diff/this.step)*this.step+this.min;return i=i>this.max?this.max:i},i.prototype.setPercent=function(t){this.$sliderSelection.width(t+"%"),this.$sliderHandle.css("left",t+"%")},i}),define("kotenei/switch",["jquery"],function(t){var e=function(e,i){this.$element=e,this.options=t.extend({},{values:{on:{text:"on",value:"1",className:""},off:{text:"off",value:"0",className:""}},callback:{onclick:t.noop}},i),this.template='<div class="k-switch"></div>',this.init()};return e.prototype.init=function(){"checkbox"===this.$element[0].type&&(this.$switch=t(this.template).append(this.build()).insertAfter(this.$element),this.$switchScroller=this.$switch.find(".k-switch-scroller"),this.$element.hide(),this.checked="checked"===this.$element.attr("checked"),this.disabled="disabled"===this.$element.attr("disabled"),this.moveLeft=this.$switch.find(".k-switch-left").width(),this.checked?this.on():this.off(),this.disabled&&this.$switch.addClass("disabled"),this.$switch.on("click",t.proxy(this.toggle,this)))},e.prototype.build=function(){var t=[],e=this.options.values;return t.push('<div class="k-switch-scroller">'),t.push('<span class="k-switch-left" >'+e.on.text+"</span>"),t.push('<span class="k-switch-middle"></span>'),t.push('<span class="k-switch-right">'+e.off.text+"</span>"),t.push("</div>"),t.join("")},e.prototype.toggle=function(){this.disabled||(this.checked?(this.checked=!1,this.off()):(this.checked=!0,this.on()),this.options.callback.onclick(this.get()))},e.prototype.on=function(){this.disabled||(this.$element.prop("checked",!0),this.$switchScroller.stop().animate({left:0},300))},e.prototype.off=function(){this.disabled||(this.$element.prop("checked",!1),this.$switchScroller.stop().animate({left:-this.moveLeft},300))},e.prototype.get=function(){var t=this.options.values;return this.checked?t.on.value:t.off.value},e.prototype.destroy=function(){this.$switch.off("click"),this.$element.show(),this.$switch.remove()},e}),define("kotenei/tooltips",["jquery"],function(t){function e(e,i){this.$element=e,this.options=t.extend({},{delay:0,content:"",tipClass:"",placement:"right",trigger:"hover click",container:t(document.body),type:"tooltips",scrollContainer:null,tpl:'<div class="k-tooltips"><div class="k-tooltips-arrow"></div><div class="k-tooltips-inner"></div></div>'},i),this.init()}return e.prototype.init=function(){var e=this;this.$tips=t(this.options.tpl),this.$tips.addClass(this.options.placement).addClass(this.options.tipClass),this.$container=t(this.options.container),this.setContent(),this.isShow=!1;for(var i,s=this.options.trigger.split(" "),o=0;o<s.length;o++)if(i=s[o],"click"===i)this.$element.on(i+"."+this.options.type,t.proxy(this.toggle,this));else if("manual"!=i){var n="hover"===i?"mouseenter":"focus",a="hover"===i?"mouseleave":"blur";this.$element.on(n+"."+this.options.type,t.proxy(this.show,this)),this.$element.on(a+"."+this.options.type,t.proxy(this.hide,this))}"BODY"!==this.$container[0].nodeName&&this.$container.css("position","relative"),this.$container.append(this.$tips),this.options.scrollContainer&&t(this.options.scrollContainer).on("scroll."+this.options.type,function(){}),t(window).on("resize."+this.options.type,function(){e.setPosition()}),this.hide()},e.prototype.setContent=function(e){e=t.trim(e||this.options.content),0===e.length&&(e=this.$element.attr("data-content")||"");var i=this.$tips;i.find(".k-tooltips-inner").html(e)},e.prototype.setPosition=function(){var t=this.getPosition();this.$tips.css(t)},e.prototype.getPosition=function(){var t,e=this.options.placement,i=(this.options.container,this.$element),s=(i.parent(),this.$tips),o=i.outerWidth(),n=i.outerHeight(),a=s.outerWidth(),h=s.outerHeight(),r={left:0,top:0},l=i[0];do r.left+=l.offsetLeft-l.scrollLeft,r.top+=l.offsetTop-l.scrollTop;while((l=l.offsetParent)&&l!=this.$container[0]);switch(e){case"left":t={top:r.top+n/2-h/2,left:r.left-a};break;case"top":t={top:r.top-h,left:r.left+o/2-a/2};break;case"right":t={top:r.top+n/2-h/2,left:r.left+o};break;case"bottom":t={top:r.top+n,left:r.left+o/2-a/2}}return t},e.prototype.show=function(){return 0===t.trim(this.options.content).length?void this.hide():(this.isShow=!0,this.setPosition(),this.$tips.show().addClass("in"),void this.setPosition())},e.prototype.hide=function(){this.isShow=!1,this.$tips.hide().removeClass("in")},e.prototype.toggle=function(){this.isShow?this.hide():this.show()},e.Global=function(i){var i=i||t('[data-module="tooltips"]');i.each(function(){var i=t(this),s=e.Get(i);s||(s=new e(i,{title:i.attr("data-title"),content:i.attr("data-content"),placement:i.attr("data-placement"),tipClass:i.attr("data-tipClass"),trigger:i.attr("data-trigger")}),e.Set(i,s))})},e.Get=function(t){return t.data("tooltips")},e.Set=function(t,e){t.data("tooltips",e)},e}),define("kotenei/tree",["jquery","kotenei/dragdrop"],function(t){var e={data:[],edit:{enable:!1},check:{enable:!1,chkType:"checkbox",chkBoxType:{Y:"ps",N:"ps"}},callback:{beforeCheck:t.noop,beforeSelect:t.noop,beforeAdd:t.noop,beforeRemove:t.noop,onCheck:t.noop,onSelect:t.noop,onAdd:t.noop,onRemove:t.noop}},i={className:{ICON:"icon",SWITCH:"switch"},floder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom"},node:{SELECTED:"selected"}},s={isArray:function(t){return t instanceof Array},getIndex:function(t,e){for(var i=0;i<e.length;i++)if(t.nodeId===e[i].nodeId)return i;return-1}},o=!1,n={getLineHtml:function(t){var e=i.line.CENTER;return t.isFirst&&0===t.parentId?e=i.line.ROOTS:t.isLast&&(e=i.line.BOTTOM),e+=t.hasChildren?t.open?"_"+i.floder.OPEN:"_"+i.floder.CLOSE:"_"+i.floder.DOCU,'<span id="switch_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+i.className.ICON+" "+i.className.SWITCH+" "+e+'"></span>'},getIconHtml:function(t){return html='<span id="'+i.className.ICON+"_"+t.nodeId+'" class="'+i.className.ICON+" ico_"+i.floder.DOCU+'"></span>',t.hasChildren&&(html=t.open?'<span id="'+i.className.ICON+"_"+t.nodeId+'"  class="'+i.className.ICON+" ico_"+i.floder.OPEN+'"></span>':'<span id="'+i.className.ICON+"_"+t.nodeId+'"  class="'+i.className.ICON+" ico_"+i.floder.CLOSE+'"></span>'),html},getChkHtml:function(t,e){if(!e.check.enable||t.noCheck)return"";var s,n=String(t.checked===!0);return"radio"===e.check.chkType&&(o?n=!1:o=!0),s=e.check.chkType+"_"+n+"_"+(t.chkDisabled?"part":"full"),'<span id="chk_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+i.className.ICON+" chk "+s+'"></span>'},replaceSwitchClass:function(t,e){var s=t.attr("class");if(s){var o=s.split("_");switch(e){case i.line.ROOT:case i.line.ROOTS:case i.line.CENTER:case i.line.BOTTOM:o[0]=i.className.ICON+" "+i.className.SWITCH+" "+e;break;case i.floder.OPEN:case i.floder.CLOSE:case i.floder.DOCU:o[1]=e}t.attr("class",o.join("_"))}},replaceChkClass:function(t,e){t.attr("class",t.attr("class").replace(e?"false":"true",e?"true":"false"))}},a=function(i,s){this.$element=i,this.options=t.extend(!0,e,s),this.nodes={},this.prefix="node",this.init()};return a.prototype.init=function(){this.initNodes(this.options.data),this.createTree(),this.eventBind()},a.prototype.initNodes=function(t){if(s.isArray(t)&&0!==t.length)for(var e,i=0;i<t.length;i++)e=t[i],0===i&&i+1<t.length?e.isFirst=!0:i+1===t.length&&(e.isLast=!0),e.hasChildren=this.hasChildren(e),e.isParent=e.hasChildren,this.nodes[this.prefix+e.nodeId]=e,this.initNodes(e.nodes)
},a.prototype.eventBind=function(){var e=this;this.$element.on("click","."+i.className.SWITCH,function(){var s=t(this),o=s.attr("nId"),a=e.$tree.find("#ul_"+o),h=e.$tree.find("#icon_"+o);0!==a.length&&a.slideToggle("fast",function(){n.replaceSwitchClass(s,"none"===a[0].style.display?i.floder.CLOSE:i.floder.OPEN),n.replaceSwitchClass(h,"none"===a[0].style.display?i.floder.CLOSE:i.floder.OPEN)})}).on("click",".chk",function(){var i=t(this),s=i.attr("nId"),o=e.getNode(s),a=this.className,h=e.getCheckedNodes(),r=-1===a.indexOf("true");if(e.options.callback.beforeCheck()!==!1&&!o.chkDisabled){if(o.checked=r,n.replaceChkClass(i,o.checked),"checkbox"===e.options.check.chkType)e.check(o);else for(var l=0;l<h.length;l++)h[l]!=o&&(h[l].checked=!1,n.replaceChkClass(e.$tree.find("#chk_"+h[l].nodeId),!1));e.options.callback.onCheck(o)}}).on("click","a",function(){var s=t(this);e.options.callback.beforeSelect()!==!1&&(s.hasClass(i.node.SELECTED)||(e.$element.find("a").removeClass(i.node.SELECTED),s.addClass(i.node.SELECTED),e.options.callback.onSelect(e.getSelectedNode())))}).on("click",".add",function(){t(this)}).on("click",".edit",function(){t(this)}).on("click",".remove",function(){t(this)})},a.prototype.createTree=function(){var e=[];e.push('<ul class="k-tree">'),this.createNode(this.options.data,e),e.push("</ul>"),this.$tree=t(e.join("")),this.$element.append(this.$tree)},a.prototype.createNode=function(t,e,i){var o,a="line";if(s.isArray(t)&&0!==t.length&&s.isArray(e)){i&&(i.isLast&&(a=""),e.push(i.open?'<ul id="ul_'+i.nodeId+'" class="'+a+'">':'<ul id="ul_'+i.nodeId+'" style="display:none;" class="'+a+'" >'));for(var o,h=0;h<t.length;h++)o=this.getNode(t[h].nodeId),o&&(e.push('<li id="li_'+o.nodeId+'" nId="'+o.nodeId+'">'),e.push(n.getLineHtml(o)),e.push(n.getChkHtml(o,this.options)),e.push('<a href="javascript:void(0);" id="a_'+o.nodeId+'" nId="'+o.nodeId+'">'),e.push(n.getIconHtml(o)),e.push("<span>"+o.text+"</span>"),e.push("</a>"),this.createNode(o.nodes,e,o),e.push("</li>"));i&&e.push("</ul>")}},a.prototype.addNodes=function(e,o){var e,a=[];if(s.isArray(o)||(o=[o]),e=e||this.getNode(o[0].parentId),this.initNodes(o),this.createNode(o,a),e){var h=this.$tree.find("#li_"+e.nodeId),r=h.find("#ul_"+e.nodeId);if(0===r.length){e.nodes=o;var l=h.find("#"+i.className.SWITCH+"_"+e.nodeId),d=h.find("#"+i.className.ICON+"_"+e.nodeId);r=t('<ul class="'+(e.isLast?"":"line")+'" />').attr("id","ul_"+e.nodeId),n.replaceSwitchClass(l,i.floder.OPEN),n.replaceSwitchClass(d,i.floder.OPEN)}else{var c=e.nodes[e.nodes.length-1],p=h.find("#li_"+c.nodeId);p.children("ul").addClass("line");var l=p.find("#"+i.className.SWITCH+"_"+c.nodeId);c.isLast=!1,n.replaceSwitchClass(l,i.line.CENTER),Array.prototype.push.apply(e.nodes,o)}r.append(a.join("")).appendTo(h)}else{var p=this.$tree.children("li").last(),u=p.find("#ul_"+p.attr("nid"));u.addClass("line"),this.$tree.append(a.join(""))}},a.prototype.removeNode=function(t){if(t){for(var e=this.getNode(t.parentId),o=this.getChildNodes(t),a=this.$tree.find("#li_"+t.parentId),h=this.$tree.find("#li_"+t.nodeId),r=h.prev(),l=h.next(),d=this.getNode(r.attr("nId")),c=this.getNode(l.attr("nId")),p=0;p<o.length;p++)this.$tree.find("#li_"+o[p].nodeId).remove(),delete this.nodes[this.prefix+o[p].nodeId];if(e){var u=s.getIndex(t,e.nodes);u>=0&&e.nodes.splice(u,1),0===e.nodes.length&&(h.parent().remove(),e.isParent=!1,e.open=!1,n.replaceSwitchClass(a.find("#"+i.className.SWITCH+"_"+e.nodeId),i.floder.DOCU),n.replaceSwitchClass(a.find("#"+i.className.ICON+"_"+e.nodeId),i.floder.DOCU))}d&&t.isLast&&(d.isLast=!0,r.children("ul").removeClass("line"),d.isFirst&&0===d.parentId?n.replaceSwitchClass(r.find("#"+i.className.SWITCH+"_"+d.nodeId),i.line.ROOT):n.replaceSwitchClass(r.find("#"+i.className.SWITCH+"_"+d.nodeId),i.line.BOTTOM)),t.isFirst&&0===t.parentId&&c&&(c.isFirst=!0,n.replaceSwitchClass(l.find("#"+i.className.SWITCH+"_"+c.nodeId),i.line.ROOT)),h.remove(),delete this.nodes[this.prefix+t.nodeId]}},a.prototype.check=function(t){function e(t,e){for(var i=!0;t&&s.isArray(t.nodes);){for(var o,n=0;n<t.nodes.length;n++)if(o=t.nodes[n],o.checked){i=!1;break}if(!i)return;this.checkAction([t],e),i=!0,t=this.getNode(t.parentId)}}var i=this.getParentNodes(t),o=this.getChildNodes(t),n=this.getNode(t.parentId),a=this.options;if(t.checked)switch(a.check.chkBoxType.Y.toLowerCase()){case"p":this.checkAction(i,t.checked);break;case"s":this.checkAction(o,t.checked);break;default:this.checkAction(i,t.checked),this.checkAction(o,t.checked)}else switch(a.check.chkBoxType.N.toLowerCase()){case"p":e.call(this,n,t.checked);break;case"s":this.checkAction(o,t.checked);break;default:e.call(this,n,t.checked),this.checkAction(o,t.checked)}},a.prototype.checkAction=function(t,e){for(var i,s,o=0;o<t.length;o++)i=t[o],i.checked=e,s=this.$tree.find("#chk_"+i.nodeId),i.chkDisabled||n.replaceChkClass(s,e)},a.prototype.getParentChildNodes=function(t){var e=this.getParentNodes(t);return this.getChildNodes(t,e),e},a.prototype.getParentNodes=function(t){for(var e=this.nodes[this.prefix+t.parentId],i=[];e;)i.push(e),e=this.nodes[this.prefix+e.parentId];return i},a.prototype.getChildNodes=function(t,e){if(e||(e=[]),!s.isArray(t.nodes))return e;for(var i=0;i<t.nodes.length;i++)e.push(t.nodes[i]),this.getChildNodes(t.nodes[i],e);return e},a.prototype.getSelectedNode=function(){var t=this.$tree.find("a.selected");if(0===t.length)return null;var e=t.attr("nId");return this.getNode(e)},a.prototype.getCheckedNodes=function(){var t=[];for(var e in this.nodes)this.nodes[e].checked&&t.push(this.nodes[e]);return t},a.prototype.getNode=function(t){return this.nodes[this.prefix+t]},a.prototype.hasChildren=function(t){return t&&s.isArray(t.nodes)&&t.nodes.length>0?!0:!1},a}),define("kotenei/util",function(){var t={},e=function(){};return t.createProto=Object.__proto__?function(t){return{__proto__:t}}:function(t){return e.prototype=t,new e},t}),define("kotenei/validate",["jquery"],function($){function Validate(t,e){this.$form=t,this.options=$.extend({},{errorClass:"k-error",errorElement:"label",rules:{},messages:{},tipsPlacement:{},focusClear:!0,keyupClear:!0,errorPlacement:null,showSingleError:!1},e),this.rules=this.options.rules,this.messages=this.options.messages,this.tipsPlacement=this.options.tipsPlacement,this.init()}return Validate.prototype.init=function(){this.getValidFields(),0!==this.validFields.count&&this.eventBind()},Validate.prototype.getValidFields=function(){this.validFields={data:{},count:0};{var t=this;this.$form.find("input,select,textarea").filter(function(){return this.getAttribute("data-rules")&&t.metaRules(this),this.name in t.rules?!0:!1}).each(function(){t.validFields.data[this.name]||(t.validFields.data[this.name]=$(this),t.validFields.count++)})}},Validate.prototype.metaRules=function(element){var meta=element.getAttribute("data-rules");meta=eval("("+meta+")"),this.rules[element.name]?($.extend(meta.rules,this.rules[element.name],!0),this.rules[element.name]=meta.rules):this.rules[element.name]=meta.rules,this.messages[element.name]?($.extend(meta.messages,this.messages[element.name],!0),this.messages[element.name]=meta.messages):this.messages[element.name]=meta.messages,this.tipsPlacement[element.name]||(this.tipsPlacement[element.name]=meta.tipsPlacement||"right")},Validate.prototype.eventBind=function(){var t=this;this.$form.on("submit",function(e){return t.validateFrom(e)}).on("focus blur keyup",':text, [type="password"], [type="file"], select, textarea, [type="number"], [type="search"] ,[type="tel"], [type="url"], [type="email"], [type="datetime"], [type="date"], [type="month"], [type="week"], [type="time"], [type="datetime-local"], [type="range"], [type="color"]',function(e){t.validate(e)}).on("click",'[type="radio"], [type="checkbox"], select, option',function(e){t.validate(e)})},Validate.prototype.validate=function(t){var e,i,s=t.target,o=$(s),n=this.rules[s.name];if(this.options.focusClear&&"focusin"===t.type||this.options.keyupClear&&"keyup"===t.type)return void this.hideError(o);if(n){i=this.elementValue(o);for(var a in n){var h={method:a,parameters:n[a]};if(e=this.methods[a].call(this,i,o,h.parameters),!e)return this.formatAndAdd(s,h),!1;this.hideError(o)}return!0}},Validate.prototype.validateFrom=function(){var t=this,e=!0;this.options.showSingleError&&this.hideAllError();for(var i in this.validFields.data)if(!t.validate({target:this.validFields.data[i][0]})&&(e=!1,this.options.showSingleError))break;return e},Validate.prototype.valid=function(){return this.validateFrom()},Validate.prototype.checkable=function(t){return/radio|checkbox/i.test(t.type)},Validate.prototype.formatAndAdd=function(t,e){var i=$(t),s=this.defaultMessage(t,e.method);s=this.format(s,e.parameters),this.showError(i,s)},Validate.prototype.showError=function(t,e){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=t.data("error");i||(i=$("<"+this.options.errorElement+">").addClass(this.options.errorClass),t.data("error",i)),i.html(e).show(),t.addClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)?this.options.errorPlacement(t,i):i.insertAfter(t)},Validate.prototype.hideError=function(t){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var e=t.data("error");t.removeClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)&&this.options.errorPlacement(t,$([])),e&&e.hide()},Validate.prototype.hideAllError=function(){for(var t in this.validFields.data)this.hideError($(this.validFields.data[t][0]))},Validate.prototype.defaultMessage=function(t,e){return this.messages[t.name]||(this.messages[t.name]={},this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]||(this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]},Validate.prototype.format=function(t,e){return-1!=t.indexOf("{0}")&&(e.constructor!==Array&&(e=[e]),$.each(e,function(e,i){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return i})})),t},Validate.prototype.removeRule=function(t,e){this.rules[t.name]&&this.rules[t.name][e]&&delete this.rules[t.name][e],this.messages[t.name]&&this.messages[t.name][e]&&delete this.messages[t.name][e]},Validate.prototype.setRules=function(t,e){this.rules[t.name]?$.extend(this.rules[t.name],e.rules,!0):this.rules[t.name]=e.rules,this.messages[t.name]?$.extend(this.messages[t.name],e.messages,!0):this.messages[t.name]=e.messages},Validate.prototype.addMethod=function(t,e,i){this.methods[t]=e,this.errorMessages[t]=void 0!==i?i:this.errorMessages[t]},Validate.prototype.errorMessages={required:"该字段不能为空",email:"电子邮箱格式错误",url:"url格式错误",date:"请输入一个有效日期",dateISO:"请输入一个有效日期（ISO）",mobile:"手机号码格式错误",phone:"电话号码格式错误",number:"请输入一个有效的数字",digits:"请输入正整数",minLength:"请输入一个长度不小于{0}个字符的值",maxLength:"请输入一个长度不大于{0}个字符的值",rangeLength:"请输入一个长度介于{0}到{1}个字符的值",min:"请输入一个大于或等于{0}的值",max:"请输入一个小于或等于{0}的值",range:"请输入一个介于{0}到{1}之间的数值",equalTo:"请再输入一个相同的值",remote:"远程验证失败"},Validate.prototype.methods={required:function(t,e){if("select"===e[0].nodeName.toLowerCase()){var i=$.trim(e.val());return i&&i.length>0}return this.checkable(e[0])?this.getLength(t,e[0])>0:$.trim(t).length>0},email:function(t,e){return this.optional(e)||/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}|\d{4}[\/-]\d{1,2}[\/-]\d{1,2}\s\d{1,2}[:]\d{1,2}[:]\d{1,2}\w$/.test(t)},mobile:function(t,e){return this.optional(e)||/^1\d{10}$/.test(t)},phone:function(t,e){return this.optional(e)||/^((0\d{2,3}\-)[1-9]\d{7}(\-\d{1,4})?)$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},minLength:function(t,e,i){var s=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||s>=i},maxLength:function(t,e,i){var s=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||i>=s},rangeLength:function(t,e,i){var s=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||s>=i[0]&&s<=i[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(t,e,i){var e=$(i);return t===this.elementValue(e)},remote:function(t,e,i){var s,o={},n=this,a=this.previousValue(e[0]);return a.old===t?a.valid:(a.old=t,"string"==typeof i?s=i:(s=i.url,o=i.data),o[e[0].name]=t,o.rnd=Math.random(),$.post(s,o).success(function(t){var i=t===!0||"true"===t.toLowerCase();i?n.hideError(e):n.showError(e,a.message),a.valid=i}).error(function(){return!1}),!0)}},Validate.prototype.previousValue=function(t){return $.data(t,"previousValue")||$.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})},Validate.prototype.optional=function(t){var e=this.elementValue(t);return!this.methods.required.call(this,e,t)},Validate.prototype.elementValue=function(t){var e=t.attr("type"),i=t.val();return"radio"===e||"checkbox"===e?$("input[name='"+t.attr("name")+"']:checked").val():"string"==typeof i?i.replace(/\r/g,""):i},Validate.prototype.getLength=function(t,e){switch(e.nodeName.toLowerCase()){case"select":return $("option:selected",e).length;case"input":if(this.checkable(e))return this.$form.find("[name='"+e.name+"']").filter(":checked").length}return t.length},Validate.prototype.getData=function(){var t={},e=this;return e.$form.find("input[name], textarea[name]").each(function(){var e=$(this);if(e.is("[type=checkbox]")===!1&&e.is("[type=radio]")===!1)t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=radio]:checked"))t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=checkbox]:checked")){var i=e.attr("name");t[i]||(t[i]=[]),t[i].push(e.val())}}),t},Validate}),define("kotenei/validateTooltips",["jquery","kotenei/validate","kotenei/tooltips","kotenei/util"],function(t,e,i,s){var o=function(t,i){e.call(this,t,i)};return o.prototype=s.createProto(e.prototype),o.prototype.getTipsPlacement=function(t){var e=t.name,i="right";return this.tipsPlacement||(this.tipsPlacement=this.options.tipsPlacement||{}),this.tipsPlacement[e]?i=this.tipsPlacement[e]:this.tipsPlacement[e]=i,i},o.prototype.showError=function(t,e){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var s=this.getTipsPlacement(t[0]),o=i.Get(t);o?o.setContent(e):(o=new i(t,{content:e,tipClass:"danger",trigger:"manual",placement:s,container:this.options.container||document.body,scrollContainer:this.options.scrollContainer}),i.Set(t,o)),o.show(),t.addClass(this.options.errorClass)},o.prototype.hideError=function(t){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var e=i.Get(t);e&&e.hide(),t.removeClass(this.options.errorClass)},o}),define("kotenei/waterfall",["jquery","kotenei/infiniteScroll","kotenei/popTips"],function(t,e,i){var s=function(e,i){this.$element=e,this.options=t.extend({},{width:200,margin:10,nodeTag:"li",resize:!1,url:null,loaded:t.noop},i),this.$window=t(window),this.$document=t(document),this.node_w=this.options.width+this.options.margin,this.loading=!1,this.noMore=!1,this.init()};return s.prototype.init=function(){var i=this;this.arrangementInit(),this.infiniteScroll=new e({$watchElement:this.$element,scrollDistance:0,callback:function(){return i.options.url?void i.remote():void(i.options.data&&i.options.data.length>0&&i.options.loaded.call(i,i.$element,i.options.data))}}),this.options.resize&&(this.$element.css("position","static"),this.$window.on("resize.waterfall",t.proxy(this.arrangementInit,this)))},s.prototype.arrangementInit=function(){if(this.arrHeight=[],this.nodes=this.$element.children(this.options.nodeTag),0!==this.nodes.length){for(var t,e,i=this.options.resize?this.$document.width()/this.node_w|0:this.$element.width()/this.node_w|0,s=0;s<this.nodes.length;s++)e=this.nodes.eq(s),t=e.outerHeight(),i>s?(this.arrHeight[s]=t,e.css({top:0,left:s*this.node_w})):this.set(e,t);this.adpHeight()}},s.prototype.arrangement=function(e){var i=this;return 0===this.arrHeight.length?void this.arrangementInit():void(e&&0!==e.length&&(e.each(function(){var e=t(this),s=e.outerHeight();i.set(e,s)}),this.adpHeight()))},s.prototype.set=function(t,e){var i=this.getMinHeight(),s=this.getMinHeightIndex(i);s=-1==s?0:s,this.arrHeight[s]+=e+this.options.margin,t.css({top:i+this.options.margin,left:s*this.node_w})},s.prototype.getMinHeightIndex=function(t){if(Array.indexOf){var e=this.arrHeight.indexOf(t);return e}for(var i=0;i<this.arrHeight.length;i++)if(this.arrHeight[i]===t)return i;return-1},s.prototype.remote=function(){if(!this.noMore&&!this.loading){var e=this;this.loading=!0,t.get(this.options.url,{rnd:Math.random()}).done(function(t){return t&&0!==t.length?(e.options.loaded.call(e,e.$element,t),void(e.loading=!1)):(e.noMore=!0,!1)}).fail(function(){i.error("网络错误！"),e.loading=!1})}},s.prototype.destory=function(){this.infiniteScroll.destory()},s.prototype.imgLoad=function(t,e,i){var s=new Image,o=this;s.onload=function(){t.attr("src",e),i(o.zoom(s.width,s.height))},s.onerror=function(){i({width:o.options.width,height:300})},s.src=e},s.prototype.zoom=function(t,e){var i;return t>e||t==e?(i=t/e,e=this.options.width/i):(i=e/t,e=this.options.width*i),{width:this.options.width,height:e}},s.prototype.getMinHeight=function(){return Math.min.apply(null,this.arrHeight)},s.prototype.getMaxHeight=function(){return Math.max.apply(null,this.arrHeight)},s.prototype.adpHeight=function(){this.$element.height(this.getMaxHeight())},s}),define("kotenei/window",["jquery","kotenei/dragdrop","kotenei/popTips","kotenei/loading"],function(t,e,i,s){var o=function(e){this.options=t.extend({},{url:null,params:null,title:"弹出框",content:null,width:"600",height:null,backdrop:!0,backdropClose:!1,iframe:!1,appendTo:document.body},e),this._event={open:t.noop,ok:t.noop,close:t.noop},this.loading=!1,this.template='<div class="k-window"><h4 class="k-window-header"><span class="k-window-title"></span><span class="k-window-close">×</span></h4><div class="k-window-container"></div><div class="k-window-footer"><button type="button" class="k-btn k-btn-primary k-window-ok">确定</button><button type="button" class="k-btn k-btn-default k-window-cancel">取消</button></div></div>',this.backdrop='<div class="k-window-backdrop"></div>',this.$document=t(document),this.$window=t(window),this.init()};o.prototype.init=function(){this.build(),this.setTitle(this.options.title),this.options.iframe?this.$container.css({padding:0,overflowY:"hidden"}).append('<iframe frameborder="0" width="100%" src="'+this.options.url+'" scrolling="auto"></iframe>'):this.setContent(this.options.content),this.eventBind()},o.prototype.eventBind=function(){var t=this;this.$window.on("resize.window",function(){t.layout()}),this.$backdrop.on("click",function(){t.options.backdropClose&&t.close()}),this.$win.on("click",".k-window-cancel,.k-window-close",function(){t.close()}).on("click",".k-window-ok",function(){t._event.ok.call(t)!==!1&&t.hide()})},o.prototype.on=function(e,i){return this._event[e]=i||t.noop,this},o.prototype.setTitle=function(t){this.$header.find(".k-window-title").text(t)},o.prototype.setContent=function(t){t=t||this.options.content,this.$container.html(t)},o.prototype.remote=function(){if("string"==typeof this.options.url&&null==this.options.content&&!this.options.iframe){var e=this,i=t.Deferred();return this.loading=!0,this.$container.load(this.options.url+"?rnd="+Math.random(),this.options.params,function(){e.loading=!1,i.resolve()}),i.promise()}},o.prototype.open=function(){var e=this;s.show(),t.when(this.remote()).done(function(){e.$win.show(),e.options.backdrop&&e.$backdrop.show(),e.layout(),e._event.open(e.$win);var t=n.get();e.$win.css("zIndex",t),e.$backdrop.css("zIndex",--t),s.hide()})},o.prototype.close=function(t){return t?void this.hide():void(this._event.close()!==!1&&this.hide())},o.prototype.hide=function(){this.$win.hide(),this.$backdrop.hide(),n.pop()},o.prototype.layout=function(){var t,e,i=this.$window.height(),s=i-100,o=this.$header.height(),n=this.$footer.height(),a=s-o-n;this.options.height?s<this.options.height?(t=s,e=a):(t=this.options.height,e=t-o-n):(this.orgHeight=this.orgHeight||this.$win.height(),s<this.orgHeight?(t=s,e=a):(t=this.orgHeight,e=this.orgHeight-o-n)),this.$container.css("height",e),this.options.iframe&&this.$container.find("iframe").height(e),this.$win.css({height:t,marginLeft:-this.$win.width()/2,marginTop:-t/2})},o.prototype.build=function(){this.$win=t(this.template).css({width:this.options.width,height:this.options.height}),this.$backdrop=t(this.backdrop),this.$header=this.$win.find(".k-window-header"),this.$container=this.$win.find(".k-window-container"),this.$footer=this.$win.find(".k-window-footer"),this.$win.appendTo(this.options.appendTo),this.$backdrop.appendTo(this.options.appendTo)},o.alert=function(e,i,s){t.isFunction(i)&&(s=i,i=e,e="提示");var n=window.winAlert;n||(n=new o({width:400,backdropClose:!1}),n.$win.find(".window-cancel").hide(),window.winAlert=n),n.$win.find(".k-window-cancel").hide(),n.setTitle(e),n.setContent(i),n.on("ok",s||t.noop),n.open()},o.confirm=function(e,i,s,n){t.isFunction(i)&&(n=s,s=i,i=e,e="确认提示");var a=window.winConfirm;a||(a=new o({width:400,backdropClose:!1}),window.winConfirm=a),a.setTitle(e),a.setContent(i),a.on("ok",s||t.noop),a.on("close",n||t.noop),a.open()};var n=function(){var t=[];return{get:function(){var e;return 0===t.length?(e=1e3,t.push(e)):(e=t[t.length-1],e+=2,t.push(e)),e},pop:function(){0!==t.length&&t.pop()}}}();return o}),define("kotenei/wordLimit",["jquery"],function(t){var e=function(e,i){this.$element=e,this.options=t.extend({},{maxLength:140,feedback:".chars"},i),this.init()};return e.prototype.init=function(){var e=this;this.maxLength=parseInt(this.$element.attr("maxLength")||this.options.maxLength),this.$feedback=t(this.options.feedback),this.$element.on("keyup",function(){var i=t.trim(t(this).val());e.update(i)}),this.update(t.trim(this.$element.val()))},e.prototype.update=function(t){var e=t.length,i=this.maxLength,s=i-e;e>=i&&this.$element.val(t.substring(0,i)),this.$feedback.html(0>s?0:s)},e.Global=function(i){i=i||t("input,textarea").filter('[data-module="wordlimit"]'),i.each(function(){var i=t(this),s=i.attr("maxLength"),o=e.Get(i);s&&(o||(o=new e(i,{maxLength:s,feedback:i.attr("data-feedback")}),e.Set(i,o)))})},e.Get=function(t){return t.data("wordLimit")},e.Set=function(t,e){t.data("wordLimit",e)},e}),define("kotenei",["kotenei/ajax","kotenei/app","kotenei/autoComplete","kotenei/cache","kotenei/clipZoom","kotenei/datepicker","kotenei/dragdrop","kotenei/dropdown","kotenei/dropdownDatepicker","kotenei/event","kotenei/highlight","kotenei/imgPreview","kotenei/infiniteScroll","kotenei/lazyload","kotenei/loading","kotenei/pager","kotenei/placeholder","kotenei/popover","kotenei/popTips","kotenei/router","kotenei/slider","kotenei/switch","kotenei/tooltips","kotenei/tree","kotenei/util","kotenei/validate","kotenei/validateTooltips","kotenei/waterfall","kotenei/window","kotenei/wordLimit"],function(t,e,i,s,o,n,a,h,r,l,d,c,p,u,f,m,g,v,y,w,$,k,x,b,C,T,I,D,F,P){return{Ajax:t,App:e,AutoComplete:i,cache:s,ClipZoom:o,Datepicker:n,Dragdrop:a,Dropdown:h,DropdownDatepicker:r,event:l,highlight:d,ImgPreview:c,InfiniteScroll:p,lazyload:u,Loading:f,Pager:m,placeholder:g,Popover:v,popTips:y,Router:w,Slider:$,Switch:k,Tooltips:x,Tree:b,Util:C,Validate:T,ValidateTooltips:I,Waterfall:D,Window:F,WordLimit:P}});