script:function(t,e){e=e.replace(/^\s/,"");var i=e.split(" "),o=i.shift(),s=i.join(" ");switch(o){case"each":var n=i[2],a=i[0];e="$each("+n+",function(index,"+a+") {";break;case"/each":e="});";break;case"for":e="for ( var "+s+") {";break;case"/for":e="}";break;case"if":e="if ("+s+") {";break;case"else":i="if"===i.shift()?" if("+i.join(" ")+")":"",e="}else"+i+"{";break;case"/if":e="}";break;default:if(/^[^\s]+\s*\|\s*[a-z]+\s*:?/.test(e)){var r=h.filtered(o,s);e=r?"$out+=$output("+r+");":"$out+=$output("+o+");"}else e=-1!=e.indexOf("?")&&-1!=e.indexOf(":")?"$out+=$output("+e+");":"$out+=$output("+o+");"}return h.setVariable(t,e),e+"\n"},html:function(t){return t=t.replace("/s+/g"," ").replace(/<!--.*?-->/g,""),t&&(t="$out+="+h.stringify(t)+";\n"),t},stringify:function(t){return"'"+t.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"},filtered:function(t,e){var i="",o=0;return n.each(e.split("|"),function(e,s){var n=s.split(":"),r=n.shift(),h=n.join(":")||"";h&&(h=","+h),r=r.replace(/\s+/g,""),r&&a[r]&&(i=0==o?"$filter."+r+"("+t+h+")":"$filter."+r+"("+i+h+")",o++)}),i},setVariable:function(t,e){e=e.replace(/\s*\.\s*[$\w\.]+/g,"").replace(/[^\w$]+/g,",").replace(new RegExp(["\\b"+r.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),"").replace(/^\d[^,]*|,\d[^,]*/g,"").replace(/^,+|,+$/g,"").split(/^$|,+/),e&&n.each(e,function(e,i){if(i&&!t[i]&&0!=i.indexOf("$")){var o="$data."+i;t.push(i+"="+o+","),t[i]=!0}})},partial:function(t,e,i){var o;if(-1==t.indexOf("partial")||!e||i>=5)return t;for(var n in e)o=new RegExp(s.open+"\\s*partial\\s*('|\")"+n+"('|\")\\s*"+s.close,"ig"),t=t.replace(o,e[n]);return i++,this.partial(t,e,i)}},l=function(e,s){++i,this.$el=e,this.options=t.extend(!0,{tpl:"",data:{},partial:null},s),this.data=this.options.data,this.tpl=this.options.tpl,this.fileName=o,this.init()};return l.prototype.init=function(){if(this.tpl)try{this.Render=e(this.tpl,this.options.partial)}catch(t){throw t}},l.prototype.render=function(){if(this.tpl){var t=this.Render(n,a,this.data);return this.$el&&this.$el.html(t),t}},l.load=function(e,i){var o=t.Deferred(),s=e.split("/");return 2===s.length&&require(["tpl/"+s[0]],function(e){var n;n=e[s[1]],n&&(n=t.trim(n),i?i(n):o.resolve(n))}),o.promise()},l.addFilter=function(t,e){a[t]=e},l.compile=function(t,i,o){return e(t,o)(n,a,i)},l}),define("km/tooltips",["jquery"],function($){function Tooltips(t,e){this.$element=t,this.options=$.extend(!0,{delay:0,content:"",tipClass:"",placement:"right",trigger:"hover click",container:$(document.body),type:"tooltips",scrollContainer:null,tpl:'<div class="k-tooltips"><div class="k-tooltips-arrow"></div><div class="k-tooltips-inner"></div></div>'},e),this.init()}return Tooltips.prototype.init=function(){var t=this;this.$tips=$(this.options.tpl),this.$tips.addClass(this.options.placement).addClass(this.options.tipClass),this.$container=$(this.options.container),this.setContent(),this.isShow=!1;for(var e,i=this.options.trigger.split(" "),o=0;o<i.length;o++)if(e=i[o],"click"===e)this.$element.on(e+"."+this.options.type,$.proxy(this.toggle,this));else if("manual"!=e){var s="hover"===e?"mouseenter":"focus",n="hover"===e?"mouseleave":"blur";this.$element.on(s+"."+this.options.type,$.proxy(this.show,this)),this.$element.on(n+"."+this.options.type,$.proxy(this.hide,this))}"BODY"!==this.$container[0].nodeName&&this.$container.css("position","relative"),this.$container.append(this.$tips),$(window).on("resize."+this.options.type,function(){t.setPosition()}),this.hide()},Tooltips.prototype.setContent=function(t){t=$.trim(t||this.options.content),0===t.length&&(t=this.$element.attr("data-content")||"");var e=this.$tips;e.find(".k-tooltips-inner").html(t)},Tooltips.prototype.setPosition=function(){var t=this.getPosition();this.$tips.css(t)},Tooltips.prototype.getPosition=function(){var t,e=this.options.placement,i=(this.options.container,this.$element),o=(i.parent(),this.$tips),s=i.outerWidth(),n=i.outerHeight(),a=o.outerWidth(),r=o.outerHeight(),h={left:0,top:0},l=i[0];do h.left+=l.offsetLeft-l.scrollLeft,h.top+=l.offsetTop-l.scrollTop;while((l=l.offsetParent)&&l!=this.$container[0]);switch(e){case"left":t={top:h.top+n/2-r/2,left:h.left-a};break;case"top":t={top:h.top-r,left:h.left+s/2-a/2};break;case"right":t={top:h.top+n/2-r/2,left:h.left+s};break;case"bottom":t={top:h.top+n,left:h.left+s/2-a/2}}return t},Tooltips.prototype.show=function(){return 0===$.trim(this.options.content).length?void this.hide():(this.isShow=!0,this.setPosition(),this.$tips.show().addClass("in"),void this.setPosition())},Tooltips.prototype.hide=function(){this.isShow=!1,this.$tips.hide().removeClass("in")},Tooltips.prototype.toggle=function(){this.isShow?this.hide():this.show()},Tooltips.prototype.destroy=function(){this.$tips.remove()},Tooltips.Global=function($elements){var $elements=$elements||$('[data-module="tooltips"]');$elements.each(function(){var $this=$(this),tooltips=Tooltips.Get($this);if(!tooltips){var options=$this.attr("data-options");options=options&&options.length>0?eval("(0,"+options+")"):{title:$this.attr("data-title"),content:$this.attr("data-content"),placement:$this.attr("data-placement"),tipClass:$this.attr("data-tipClass"),trigger:$this.attr("data-trigger")},tooltips=new Tooltips($this,options),Tooltips.Set($this,tooltips)}})},Tooltips.Get=function(t){return $.data(t[0],"tooltips")},Tooltips.Set=function(t,e){$.data(t[0],"tooltips",e)},Tooltips}),define("km/tree",["jquery","km/dragdrop"],function(t,e){var i={className:{ICON:"icon",SWITCH:"switch"},floder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom"},node:{SELECTED:"selected"}},o={isArray:function(t){return t instanceof Array},getIndex:function(t,e){for(var i=0;i<e.length;i++)if(t.nodeId===e[i].nodeId)return i;return-1}},s=!1,n={getLineHtml:function(t,e){if(e.view.showLine){var o=i.line.CENTER;return t.isSingle?o=i.line.ROOT:t.isFirst&&0===t.parentId?o=i.line.ROOTS:t.isLast&&(o=i.line.BOTTOM),o+=t.hasChildren?t.open?"_"+i.floder.OPEN:"_"+i.floder.CLOSE:"_"+i.floder.DOCU,'<span id="switch_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+i.className.ICON+" "+i.className.SWITCH+" "+o+'"></span>'}},getIconHtml:function(t,e){return e.view.showIcon?(html='<span id="'+i.className.ICON+"_"+t.nodeId+'" class="'+i.className.ICON+" ico_"+i.floder.DOCU+'"></span>',t.hasChildren&&(t.open?html='<span id="'+i.className.ICON+"_"+t.nodeId+'"  class="'+i.className.ICON+" ico_"+i.floder.OPEN+'"></span>':html='<span id="'+i.className.ICON+"_"+t.nodeId+'"  class="'+i.className.ICON+" ico_"+i.floder.CLOSE+'"></span>'),html):void 0},getChkHtml:function(t,e){if(!e.check.enable||t.noCheck)return"";var o,n=String(t.isChecked===!0);return"radio"===e.check.chkType&&(s?n=!1:s=!0),o=e.check.chkType+"_"+n+"_"+(t.checkDisabled?"part":"full"),'<span id="chk_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+i.className.ICON+" chk "+o+'"></span>'},replaceSwitchClass:function(t,e){var o=t.attr("class");if(o){var s=o.split("_");switch(e){case i.line.ROOT:case i.line.ROOTS:case i.line.CENTER:case i.line.BOTTOM:s[0]=i.className.ICON+" "+i.className.SWITCH+" "+e;break;case i.floder.OPEN:case i.floder.CLOSE:case i.floder.DOCU:s[1]=e}t.attr("class",s.join("_"))}},replaceChkClass:function(t,e){t&&0!=t.length&&t.attr("class",t.attr("class").replace(e?"false":"true",e?"true":"false"))}},a=function(e,i){this.$element=e,this.options=t.extend(!0,{selectLimit:!1,data:[],edit:{enable:!1},check:{enable:!1,chkType:"checkbox",chkBoxType:{Y:"ps",N:"ps"},keepSearch:!1},callback:{beforeCheck:t.noop,beforeSelect:t.noop,beforeAdd:t.noop,beforeRemove:t.noop,onCheck:t.noop,onSelect:t.noop,onAdd:t.noop,onRemove:t.noop},view:{showLine:!0,showIcon:!0}},i),this.nodes={},this.prefix="node",this.init()};return a.prototype.init=function(){this.initNodes(this.options.data),this.createTree(),this.eventBind()},a.prototype.initNodes=function(t,e){if(o.isArray(t)&&0!==t.length)for(var i,s=0;s<t.length;s++)i=t[s],0===s&&s+1<t.length?i.isFirst=!0:0===s&&s+1==t.length?i.isSingle=!0:s+1===t.length&&(i.isLast=!0),!i.parentId&&e&&(i.parentId=e.nodeId),i.hasChildren=this.hasChildren(i),i.isParent=i.hasChildren,i.parent=e,this.nodes[this.prefix+i.nodeId]=i,this.initNodes(i.nodes,i)},a.prototype.eventBind=function(){var e=this;this.$element.on("click.tree","."+i.className.SWITCH,function(){var o=t(this),s=o.attr("nId"),a=e.$tree.find("#ul_"+s),r=e.$tree.find("#icon_"+s);0!==a.length&&a.slideToggle("fast",function(){n.replaceSwitchClass(o,"none"===a[0].style.display?i.floder.CLOSE:i.floder.OPEN),n.replaceSwitchClass(r,"none"===a[0].style.display?i.floder.CLOSE:i.floder.OPEN)})}).on("click.tree",".chk",function(){var i=t(this),o=i.attr("nId"),s=e.getNode(o),a=this.className,r=e.getCheckedNodes(),h=-1===a.indexOf("true");if(e.options.callback.beforeCheck()!==!1&&!s.checkDisabled){if(s.isChecked=h,n.replaceChkClass(i,s.isChecked),"checkbox"===e.options.check.chkType)e.check(s);else for(var l=0;l<r.length;l++)r[l]!=s&&(r[l].isChecked=!1,n.replaceChkClass(e.$tree.find("#chk_"+r[l].nodeId),!1));e.options.callback.onCheck(s)}}).on("click.tree","a",function(){var o=t(this),s=o.attr("nid"),n=e.getNode(s);n.selectDisabled||e.options.callback.beforeSelect()!==!1&&(o.hasClass(i.node.SELECTED)&&e.options.selectLimit||(e.$element.find("a").removeClass(i.node.SELECTED),o.addClass(i.node.SELECTED),e.options.callback.onSelect(e.getSelectedNode())))}).on("click.tree",".add",function(){t(this)}).on("click.tree",".edit",function(){t(this)}).on("click.tree",".remove",function(){t(this)})},a.prototype.createTree=function(){var e=[];e.push('<ul class="k-tree">'),this.createNode(this.options.data,e),e.push("</ul>"),this.$tree=t(e.join("")),this.$element.append(this.$tree)},a.prototype.createNode=function(t,e,s){var a,r="line";if(o.isArray(t)&&0!==t.length&&o.isArray(e)){if(s){if(0==s.canBuild)return;(s.isLast||s.isSingle)&&(r=""),s.open?e.push('<ul id="ul_'+s.nodeId+'" class="'+r+'">'):e.push('<ul id="ul_'+s.nodeId+'" style="display:none;" class="'+r+'" >')}for(var a,h=0;h<t.length;h++)a=this.getNode(t[h].nodeId),a&&0!=a.canBuild&&(e.push('<li id="li_'+a.nodeId+'" nId="'+a.nodeId+'">'),e.push(n.getLineHtml(a,this.options)),e.push(n.getChkHtml(a,this.options)),e.push('<a href="javascript:void(0);" id="a_'+a.nodeId+'" nId="'+a.nodeId+'" class="'+(a.selected?i.node.SELECTED:"")+" "+(a.selectDisabled?"disabled":"")+'" >'),e.push(n.getIconHtml(a,this.options)),e.push("<span>"+a.text+"</span>"),e.push("</a>"),this.createNode(a.nodes,e,a),e.push("</li>"));s&&e.push("</ul>")}},a.prototype.addNodes=function(e,s){var e,a=[];if(o.isArray(s)||(s=[s]),e=e||this.getNode(s[0].parentId),this.initNodes(s),this.createNode(s,a),e){var r=this.$tree.find("#li_"+e.nodeId),h=r.find("#ul_"+e.nodeId);if(0===h.length){e.nodes=s;var l=r.find("#"+i.className.SWITCH+"_"+e.nodeId),p=r.find("#"+i.className.ICON+"_"+e.nodeId);h=t('<ul class="'+(e.isLast?"":"line")+'" />').attr("id","ul_"+e.nodeId),n.replaceSwitchClass(l,i.floder.OPEN),n.replaceSwitchClass(p,i.floder.OPEN)}else{var d=e.nodes[e.nodes.length-1],c=r.find("#li_"+d.nodeId);c.children("ul").addClass("line");var l=c.find("#"+i.className.SWITCH+"_"+d.nodeId);d.isLast=!1,n.replaceSwitchClass(l,i.line.CENTER),Array.prototype.push.apply(e.nodes,s)}h.append(a.join("")).appendTo(r)}else{var c=this.$tree.children("li").last(),u=c.find("#ul_"+c.attr("nid"));u.addClass("line"),this.$tree.append(a.join(""))}},a.prototype.removeNode=function(t){if(t){for(var e=this.getNode(t.parentId),s=this.getChildNodes(t),a=this.$tree.find("#li_"+t.parentId),r=this.$tree.find("#li_"+t.nodeId),h=r.prev(),l=r.next(),p=this.getNode(h.attr("nId")),d=this.getNode(l.attr("nId")),c=0;c<s.length;c++)this.$tree.find("#li_"+s[c].nodeId).remove(),delete this.nodes[this.prefix+s[c].nodeId];if(e){var u=o.getIndex(t,e.nodes);u>=0&&e.nodes.splice(u,1),0===e.nodes.length&&(r.parent().remove(),e.isParent=!1,e.open=!1,n.replaceSwitchClass(a.find("#"+i.className.SWITCH+"_"+e.nodeId),i.floder.DOCU),n.replaceSwitchClass(a.find("#"+i.className.ICON+"_"+e.nodeId),i.floder.DOCU))}p&&t.isLast&&(p.isLast=!0,h.children("ul").removeClass("line"),p.isFirst&&0===p.parentId?n.replaceSwitchClass(h.find("#"+i.className.SWITCH+"_"+p.nodeId),i.line.ROOT):n.replaceSwitchClass(h.find("#"+i.className.SWITCH+"_"+p.nodeId),i.line.BOTTOM)),t.isFirst&&0===t.parentId&&d&&(d.isFirst=!0,n.replaceSwitchClass(l.find("#"+i.className.SWITCH+"_"+d.nodeId),i.line.ROOT)),r.remove(),delete this.nodes[this.prefix+t.nodeId]}},a.prototype.check=function(t){function e(t,e){for(var i=!0;t&&o.isArray(t.nodes);){for(var s,n=0;n<t.nodes.length;n++)if(s=t.nodes[n],s.isChecked){i=!1;break}if(!i)return;this.checkAction([t],e),i=!0,t=this.getNode(t.parentId)}}var i=this.getParentNodes(t),s=this.getChildNodes(t),n=this.getNode(t.parentId),a=this.options;if(t.isChecked)switch(a.check.chkBoxType.Y.toLowerCase()){case"p":this.checkAction(i,t.isChecked);break;case"s":this.checkAction(s,t.isChecked);break;case"ps":this.checkAction(i,t.isChecked),this.checkAction(s,t.isChecked)}else switch(a.check.chkBoxType.N.toLowerCase()){case"p":e.call(this,n,t.isChecked);break;case"s":this.checkAction(s,t.isChecked);break;case"ps":e.call(this,n,t.isChecked),this.checkAction(s,t.isChecked)}},a.prototype.checkAction=function(t,e){for(var i,o,s=0;s<t.length;s++)i=t[s],i.isChecked=e,o=this.$tree.find("#chk_"+i.nodeId),i.checkDisabled||n.replaceChkClass(o,e)},a.prototype.getParentChildNodes=function(t){var e=this.getParentNodes(t);return this.getChildNodes(t,e),e},a.prototype.getParentNodes=function(t){for(var e=this.nodes[this.prefix+t.parentId],i=[];e;)i.push(e),e=this.nodes[this.prefix+e.parentId];return i},a.prototype.getChildNodes=function(t,e){if(e||(e=[]),!o.isArray(t.nodes))return e;for(var i=0;i<t.nodes.length;i++)e.push(t.nodes[i]),this.getChildNodes(t.nodes[i],e);return e},a.prototype.getSelectedNode=function(){var t=this.$tree.find("a."+i.node.SELECTED);if(0===t.length)return null;var e=t.attr("nId");return this.getNode(e)},a.prototype.getCheckedNodes=function(){var t=[];for(var e in this.nodes)this.nodes[e].isChecked&&t.push(this.nodes[e]);return t},a.prototype.getNode=function(t){return this.nodes[this.prefix+t]},a.prototype.hasChildren=function(t){return!!(t&&o.isArray(t.nodes)&&t.nodes.length>0)},a.prototype.selectNode=function(t){if(t){var e=this.getNode(t);e&&!e.selectDisabled&&this.$tree.find("#a_"+t).click()}},a.prototype.unSelectNode=function(e,o){o=o||t.noop;var s,n=this.$tree.find("#a_"+e),e=n.attr("nid");0!=n.length&&n.hasClass(i.node.SELECTED)&&(s=this.getNode(e),n.removeClass(i.node.SELECTED),o(this.getNode(e)))},a.prototype.checkNode=function(t){var e=this.$tree.find("#chk_"+t),i=e.attr("class");0!=e.length&&-1!=i.indexOf("false")&&e.click()},a.prototype.unCheckNode=function(t){var e=this.$tree.find("#chk_"+t),i=e.attr("class");0!=e.length&&-1!=i.indexOf("true")&&e.click()},a.prototype.search=function(t){function e(t,e,i){var s=function(t){t&&!t.canBuild&&(t.canBuild=!0,s(t.parent))},n=function(t,e,i){if(o.isArray(t)&&0!==t.length)for(var a,r=0;r<t.length;r++)a=t[r],a.canBuild=!1,i.check.keepSearch||(a.isChecked=!1),e?-1==a.text.indexOf(e)?a.canBuild=!1:(a.canBuild=!0,s(a.parent)):a.canBuild=!0,n(a.nodes,e,i)};n(t,e,i)}if(this.options.data){var i=[];e(this.options.data,t,this.options),this.createNode(this.options.data,i),this.$tree.children("li").remove().end().html(i.join(""))}},a.prototype.getNodesByText=function(t){var e=[];if(this.nodes)for(var i in this.nodes)this.nodes[i].text.toLowerCase()==t.toLowerCase()&&e.push(this.nodes[i]);return e},a.prototype.getNodesByValue=function(t){var e=[];if(this.nodes)for(var i in this.nodes)this.nodes[i].value.toLowerCase()==t.toLowerCase()&&e.push(this.nodes[i]);return e},a.prototype.setDisabled=function(t,e){var i=this.getNode(t);i&&("undefined"==typeof e&&(e=!0),e?(this.unCheckNode(t),this.unSelectNode(t),i.checkDisabled=!0,i.selectDisabled=!0,this.$tree.find("#a_"+t).addClass("disabled"),this.$tree.find("#chk_"+t).addClass(this.options.check.chkType+"_false_part")):(i.checkDisabled=!1,i.selectDisabled=!1,this.$tree.find("#a_"+t).removeClass("disabled"),this.$tree.find("#chk_"+t).removeClass(this.options.check.chkType+"_false_part")))},a.prototype.reload=function(t){t=t||this.options.data;var e=[];this.nodes={},this.initNodes(t),this.options.data=t,this.createNode(this.options.data,e),this.$tree.children("li").remove().end().html(e.join(""))},a}),define("km/treeTable",["jquery","km/ajax"],function(t,e){function i(e,i){this.$elm=e,this.options=t.extend(!0,{expanded:!0,className:"k-treeTable",url:"",params:null,column:0,columns:[],data:[],checkType:{Y:"ps",N:"ps"}},i),this.init()}return i.prototype.init=function(){var t=this;this.options.data&&this.options.data.length>0?(this.data=this.options.data,this.dataInit(),this.build(),this.watch()):this.options.url&&this.options.url.length>0&&t.reload()},i.prototype.watch=function(){var e=this;this.$elm.on("click.treetable",".indenter a",function(){var i=t(this).attr("data-nodeId"),o=t("#treeRow_"+i),s=e.getChildren(e.objData[i]);return o.hasClass("expanded")?(o.removeClass("expanded").addClass("collapsed"),e.collapsed(s)):(o.removeClass("collapsed").addClass("expanded"),e.expanded(s)),!1}).on("click.treetable","tbody tr",function(){var i=t(this),o=i.attr("data-nodeId"),s=e.objData[o];s.enableCheck&&(i.hasClass("selected")?(i.removeClass("selected"),i.find("td:eq(0)").find("input").prop("checked",!1),s.checked=!1,e.check(s,!1)):(i.addClass("selected"),i.find("td:eq(0)").find("input").prop("checked",!0),s.checked=!0,e.check(s,!0)))}).on("click.treetable","[role=checkall]",function(){for(var i,o=t(this),s=(e.$elm.find("tbody tr"),o.prop("checked")),n=0;n<e.data.length;n++)i=e.data[n],i.enableCheck&&(i.checked=s,s?(t("#treeRow_"+i.nodeId).addClass("selected"),t("#treeCheckBox_"+i.nodeId).prop("checked",!0)):(t("#treeRow_"+i.nodeId).removeClass("selected"),t("#treeCheckBox_"+i.nodeId).prop("checked",!1))),e.data[n].checked=s})},i.prototype.dataInit=function(){function e(e,i){var o=function(i,s,n,a){for(var r,h=0;h<e.length;h++)r=e[h],r.parentId==i&&(r.hasParent=!0,0==r.parentId&&(r.isRoot=!0,r.level=1,r.hasParent=!1),n&&(n.hasChild=!0,r.level=n.level+1||1,r.parent=n,t.isArray(n.children)||(n.children=[]),n.children.push(r.nodeId)),s.push(r),o(r.nodeId,s,r))};o(0,i,null,1)}var i=[];this.data;this.objData={},e(this.data,i),0==i.length&&(i=this.data);for(var o=0;o<i.length;o++)this.objData[i[o].nodeId]=i[o],null!=i[o].enableCheck&&"undefined"!=typeof i[o].enableCheck||(i[o].enableCheck=!0);this.data=i},i.prototype.build=function(){var t=[],e=this.options.columns;t.push('<table class="'+this.options.className+'">'),t.push("<thead>");for(var i,o=0;o<e.length;o++)i=e[o],i.checkbox?(t.push('<th style="text-align:'+(i.align?i.align:"left")+'">'),t.push('<input type="checkbox" role="checkall" />'),t.push("</th>")):t.push('<th style="text-align:'+(i.align?i.align:"left")+'">'+i.title+"</th>");t.push("</thead>"),t.push("<tbody>");for(var s,n,a,o=0;o<this.data.length;o++){s=this.data[o],n="",a="",s.hasChild&&(this.options.expanded?n="expanded":(n="collapsed",s.isRoot||(a="hide"))),!this.options.expanded&&s.hasParent&&s.parentId>0&&(a="hide");var r="";this.options.columns[0].checkbox&&s.checked&&(r="selected"),t.push('<tr class="'+n+" "+a+" "+r+'" id="treeRow_'+s.nodeId+'"  data-parentId="'+s.parentId+'" data-nodeId="'+s.nodeId+'" data-level="'+s.level+'">');for(var i,h=0;h<e.length;h++)if(i=e[h],i.checkbox){var l="";s.checked&&(l=' checked="checked" '),s.enableCheck||(l+=' disabled="disabled" '),t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push('<input type="checkbox" id="treeCheckBox_'+s.nodeId+'" value="'+s[i.field]+'"  '+l+"  />"),t.push("</td>")}else{var p="",d="";h==this.options.column&&(s.hasChild?(p='<span class="indenter" style="padding-left: '+(s.level>1?19*s.level:0)+'px;"><a href="#" title="Collapse" data-nodeId="'+s.nodeId+'">&nbsp;</a></span>',d='<span class="folder">'+("function"==typeof i.formatter?i.formatter(s[i.field],s):s[i.field])+"</span>"):(p='<span class="indenter" style="padding-left: '+(s.level>1?19*s.level:0)+'px;"></span>',d='<span class="file">'+("function"==typeof i.formatter?i.formatter(s[i.field],s):s[i.field])+"</span>")),"function"==typeof i.formatter?(t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push(p),t.push(d.length>0?d:i.formatter(s[i.field],s)),t.push("</td>")):(t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push(p),t.push(d.length>0?d:s[i.field]),t.push("</td>"))}t.push("</tr>")}t.push("</tbody>"),t.push("</table>"),this.$elm.html(t.join(""))},i.prototype.check=function(e,i){function o(i,o){for(var s=0;s<o.length;s++)if(o[s].checked){r=!1;break}var n=e.parent;for(r&&n&&n.enableCheck&&(n.checked=!1,t("#treeRow_"+n.nodeId).removeClass("selected"),t("#treeCheckBox_"+n.nodeId).prop("checked",!1));n;){for(var a=this.getBrothers(n),s=0;s<a.length;s++)if(a[s].checked){r=!1;break}if(!r||!n.enableCheck)break;n.checked=!1,t("#treeRow_"+n.nodeId).removeClass("selected"),t("#treeCheckBox_"+n.nodeId).prop("checked",!1),n=n.parent}}var s=this.getParents(e),n=this.getChildren(e),a=this.getBrothers(e),r=!0;t("#treeRow_"+e.nodeId),t("#treeCheckBox_"+e.nodeId);if(i)switch(this.options.checkType.Y.toLowerCase()){case"p":this.checkAction(s,i);break;case"s":this.checkAction(n,i);break;default:this.checkAction(s,i),this.checkAction(n,i)}else switch(this.options.checkType.N.toLowerCase()){case"p":o.call(this,e,a);break;case"s":this.checkAction(n,i);break;default:o.call(this,e,a),this.checkAction(n,i)}},i.prototype.checkAction=function(e,i){for(var o,s,n,a=0;a<e.length;a++)o=e[a],n=t("#treeCheckBox_"+o.nodeId),s=t("#treeRow_"+o.nodeId),o.enableCheck&&(i?(o.checked=!0,s.addClass("selected"),n.prop("checked",!0)):(o.checked=!1,s.removeClass("selected"),n.prop("checked",!1)))},i.prototype.expanded=function(e){for(var i,o,s,n=0;n<e.length;n++)i=e[n],o=t("#treeRow_"+i.nodeId),s=t("#treeRow_"+i.parentId),s.hasClass("collapsed")?o.addClass("hide"):o.removeClass("hide")},i.prototype.collapsed=function(e){for(var i,o,s=0;s<e.length;s++)i=e[s],o=t("#treeRow_"+i.nodeId),o.addClass("hide")},i.prototype.getParents=function(t){for(var e=[],i=t.parent;i;)e.push(i),i=i.parent;return e},i.prototype.getBrothers=function(t){for(var e,i=[],o=0;o<this.data.length;o++)e=this.data[o],t.parentId==e.parentId&&e.nodeId!=t.nodeId&&i.push(e);return i},i.prototype.getChildren=function(t){var e=[],i=function(t,e,o){if(t.children)for(var s,n=0;n<t.children.length;n++)s=o[t.children[n]],e.push(s),s.hasChild&&i(s,e,o)};return i(t,e,this.objData),e},i.prototype.reload=function(){var t=this;e.get(this.options.url,this.options.params).done(function(e){if(!e)return void(e=[]);for(var i,o=0;o<e.length;o++)i=e[o],i.Checked&&(i.checked=i.Checked),i.EnableCheck&&(i.enableCheck=i.EnableCheck),i.Level&&(i.level=i.Level);t.data=e,t.dataInit(),t.build(),t.watch()})},i.prototype.loadData=function(){},i.prototype.getSelectRows=function(){var t=[];if(!this.data)return t;for(var e,i=0;i<this.data.length;i++)e=this.data[i],e.checked&&t.push(e);return t},i}),define("km/upload",["jquery","spin","km/window","km/ajax","km/event","km/popTips","jqueryForm"],function($,Spinner,Window,ajax,event,popTips){var method={showLoading:function(){this.spinner.spin(this.$loadingBox.get(0)),this.$loadingBox.css("display","inline-block"),this.$uploadIcon.hide()},hideLoading:function(){this.$loadingBox.hide(),this.spinner.stop(),this.$uploadIcon.show()}},Upload=function(t,e){this.$elm=t,this.options=$.extend(!0,{uploadUrl:null,removeUrl:null,$target:null,fontClassName:"fa fa-upload",text:"上传",name:"file",uploadedUrls:[],showResult:!0,popTips:{enable:!0,delay:600}},e),this.isLoading=!1,this.isButton="text"!=this.$elm[0].type.toLowerCase(),this._event={success:$.noop,error:$.noop},this.init()};return Upload.prototype.init=function(){this.spinner=new Spinner({lines:9,length:3,width:2,radius:2,scale:.2,corners:.6,rotate:4,direction:1,color:"#222222",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"5px",left:"10px"}),this.uploadedUrls=this.options.uploadedUrls,this.build(),this.watch()},Upload.prototype.watch=function(){var t=this;this.$uploadBox.on("change.upload","input",function(){t.upload()}).on("click.upload",".fa-close",function(){var e=$(this),i=e.parents(".k-upload-result:eq(0)"),o=i.attr("data-url");t.isLoading||Window.confirm("您确认要删除该文件吗？",function(){t.removeFile(t.isButton?{filePath:o}:null)})})},Upload.prototype.build=function(){var t=[],e=[];if(t.push('<div class="k-upload-box">'),this.isButton&&this.options.showResult){if(t.push('<div class="k-upload-result-box">'),this.options.uploadedUrls.length>0)for(var i=0;i<this.options.uploadedUrls.length;i++)t.push('<div class="k-upload-result" data-url="'+this.options.uploadedUrls[i]+'">'),t.push('<span title="'+this.options.uploadedUrls[i]+'">'+this.options.uploadedUrls[i]+"</span>"),t.push('<i class="fa fa-close" style="display:'+(this.options.removeUrl?"block":"none")+';"></i>'),t.push("</div>");t.push("</div>")}if(t.push('<div class="button-box">'),t.push('<button type="button" class="k-btn k-btn-default">'),t.push('<div class="loading-box"></div>'),t.push('<span class="k-upload-icon '+this.options.fontClassName+'"></span>&nbsp;'),t.push(this.options.text),t.push("</button>"),t.push('<form action="'+this.options.uploadUrl+'" enctype="multipart/form-data" method="post">'),t.push('<input type="file" name="'+this.options.name+'" />'),t.push("</form>"),t.push("</div>"),t.push("</div>"),!this.isButton){var o=$.trim(this.$elm.val());e.push('<div class="k-input-group k-input-group-upload">'),e.push('<i class="fa fa-close" style="display:'+(this.options.removeUrl&&o.length>0?"block":"none")+';"></i>'),e.push('<span class="k-input-group-btn">'),e.push(t.join("")),e.push("</span>"),e.push("</div>")}this.$uploadBox=$(0==e.length?t.join(""):e.join("")),this.$buttonBox=this.$uploadBox.find(".button-box"),this.$button=this.$uploadBox.find("button"),this.$file=this.$uploadBox.find("input[type=file]"),this.$form=this.$uploadBox.find("form"),this.$resultBox=this.$uploadBox.find(".k-upload-result-box"),this.$txtResult=this.isButton?null:this.$elm,this.$close=this.$uploadBox.find(".fa-close"),this.$uploadBox.appendTo(this.$elm.parent()),this.$uploadIcon=this.$uploadBox.find(".k-upload-icon"),this.$loadingBox=this.$buttonBox.find(".loading-box"),this.isButton?this.$elm.hide():(this.$elm.attr({"class":"k-form-control"}).prependTo(this.$uploadBox),this.$close.css("right",this.$button.outerWidth()+10))},Upload.prototype.upload=function(){var t=this;this.isLoading||(this.isLoading=!0,method.showLoading.call(this),this.$form.ajaxSubmit({url:this.$form.attr("action"),cache:!1,success:function(e){"string"==typeof e&&(e=JSON.parse(e)),t.isButton&&e.Url&&e.Url.length>0&&t.uploadedUrls.push(e.Url),t.showResult(e.Url||""),t._event.success(e)},error:function(){t._event.error()},complete:function(){t.isLoading=!1,method.hideLoading.call(t)}}))},Upload.prototype.removeFile=function(t){var e=this;this.isLoading||(this.isLoading=!0,t=t||{filePath:this.url},ajax.post(this.options.removeUrl,t,{redirectEnable:!1,loadingEnable:!0,popTips:{enable:this.options.popTips.enable,delay:this.options.delay,inCallback:!1}}).done(function(i){(i.Status||i.status)&&e.hideResult(t.filePath)}).always(function(){e.isLoading=!1}))},Upload.prototype.showResult=function(t){this.url=t,this.isButton?(this.options.showResult&&this.$resultBox.append('<div class="k-upload-result" data-url="'+t+'"><span title="'+t+'">'+t+'</span><i class="fa fa-close" style="display:'+(this.options.removeUrl?"block":"none")+';"></i></div>'),this.options.$target&&this.options.$target.val(this.uploadedUrls.join(","))):(this.$txtResult.val(t),this.options.removeUrl&&this.$close.fadeIn(),this.options.$target&&this.options.$target.val(t))},Upload.prototype.hideResult=function(t){var e=-1;if(this.isButton){this.$resultBox.children('div[data-url="'+t+'"]').remove();for(var i=0;i<this.uploadedUrls.length;i++)if(this.uploadedUrls[i]==t){e=i;break}i>=0&&this.uploadedUrls.splice(e,1),this.options.$target&&this.options.$target.val(this.uploadedUrls.join(","))}else this.$txtResult.val(""),this.$close.hide(),this.options.$target&&this.options.$target.val("")},Upload.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Upload.Global=function($elms){$elms=$elms||$("button[data-module=upload],input[data-module=upload]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),uploadUrl=$el.attr("data-uploadurl"),removeUrl=$el.attr("data-removeurl"),name=$el.attr("data-name"),text=$el.attr("data-text"),loadingEnable=$el.attr("data-loadingEnable"),popTips=$el.attr("data-popTips"),success=$el.attr("data-success"),error=$el.attr("data-error"),data=$.data($el[0],"upload");data||(options=options&&options.length>0?eval("(0,"+options+")"):{uploadUrl:uploadUrl&&uploadUrl.length>0?uploadUrl:"",removeUrl:removeUrl&&removeUrl.length>0?removeUrl:"",name:name&&name.length>0?name:"file",text:text&&text.length>0?text:"上传",loadingEnable:!loadingEnable||"false"!=loadingEnable,popTips:popTips&&popTips.length>0?eval("(0,"+popTips+")"):{}},data=new Upload($el,options),data.on("success",success&&success.length>0?eval("(0,"+success+")"):$.noop).on("error",error&&error.length>0?eval("(0,"+error+")"):$.noop),$.data($el[0],"upload",data))})},Upload}),define("km/util",function(){var t={},e=function(){};return t.createProto=Object.__proto__?function(t){return{__proto__:t}}:function(t){return e.prototype=t,new e},t.isIE8=function(){var t,e=8,i=navigator.userAgent.toLowerCase(),o=i.indexOf("msie")>-1;return o?(t=parseInt(i.match(/msie ([\d.]+)/)[1]),e>=t&&-1==i.indexOf("trident/7.0")):!1},t}),define("km/validate",["jquery"],function($){function Validate(t,e){this.$form=t,this.options=$.extend(!0,{errorClass:"k-error",errorElement:"label",rules:{},messages:{},tipsPlacement:{},focusClear:!0,keyupClear:!0,errorPlacement:null,showSingleError:!1},e),this.rules=this.options.rules,this.messages=this.options.messages,this.tipsPlacement=this.options.tipsPlacement,this.init()}return Validate.prototype.init=function(){this.setValidFields(),0!==this.validFields.count&&(this.eventBind(),$.data(this.$form[0],"validate",this))},Validate.prototype.setValidFields=function(){this.validFields={data:{},count:0};var t=this;this.$form.find("input,select,textarea").filter(function(){return this.getAttribute("data-rules")&&t.metaRules(this),this.name in t.rules}).each(function(){if(!t.validFields.data[this.name]){var e=$(this);$.data(e[0],"$form",t.$form),t.validFields.data[this.name]=e,t.validFields.count++}})},Validate.prototype.metaRules=function(element){var meta=element.getAttribute("data-rules");meta=eval("(0,"+meta+")"),this.rules[element.name]?($.extend(meta.rules,this.rules[element.name],!0),this.rules[element.name]=meta.rules):this.rules[element.name]=meta.rules,this.messages[element.name]?($.extend(meta.messages,this.messages[element.name],!0),this.messages[element.name]=meta.messages):this.messages[element.name]=meta.messages,this.tipsPlacement[element.name]||(this.tipsPlacement[element.name]=meta.tipsPlacement||{position:"right",target:element})},Validate.prototype.eventBind=function(){var t=this;this.$form.on("submit.validate",function(e){return t.validateFrom(e)}).on("focus.validate blur.validate keyup.validate",':text, [type="password"], [type="file"], select, textarea, [type="number"], [type="search"] ,[type="tel"], [type="url"], [type="email"], [type="datetime"], [type="date"], [type="month"], [type="week"], [type="time"], [type="datetime-local"], [type="range"], [type="color"]',function(e){t.validate(e)}).on("click.validate",'[type="radio"], [type="checkbox"], select, option',function(e){t.validate(e)})},Validate.prototype.validate=function(t){var e,i,o=t.target,s=$(o),n=this.rules[o.name];if(n){if(this.options.focusClear&&("focusin"===t.type||"click"==t.type)||this.options.keyupClear&&"keyup"===t.type)return void this.hideError(s);
i=this.elementValue(s);for(var a in n){var r={method:a,parameters:n[a]};if(e=this.methods[a].call(this,i,s,r.parameters),!e)return this.formatAndAdd(o,r),!1;this.hideError(s)}return!0}},Validate.prototype.validateFrom=function(){var t=this,e=!0,i=[];for(var o in this.validFields.data)t.validate({target:this.validFields.data[o][0]})||(e=!1,i.push({$element:$(this.validFields.data[o][0])}));if(this.options.showSingleError&&i.length>1)for(var s=1;s<i.length;s++)$element=i[s].$element,this.hideError($element,!1);return e},Validate.prototype.valid=function(){return this.validateFrom()},Validate.prototype.checkable=function(t){return/radio|checkbox/i.test(t.type)},Validate.prototype.formatAndAdd=function(t,e){var i=$(t),o=this.defaultMessage(t,e.method);o=this.format(o,e.parameters),this.showError(i,o)},Validate.prototype.showError=function(t,e){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=$.data(t[0],"error");i||(i=$("<"+this.options.errorElement+">").addClass(this.options.errorClass),$.data(t[0],"error",i)),i.html(e).show(),t.addClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)?this.options.errorPlacement(t,i):i.insertAfter(t)},Validate.prototype.hideError=function(t,e){"undefined"==typeof e&&(e=!0),this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=$.data(t[0],"error");e&&t.removeClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)&&this.options.errorPlacement(t,$([])),i&&i.hide()},Validate.prototype.hideAllError=function(){for(var t in this.validFields.data)this.hideError($(this.validFields.data[t][0]))},Validate.prototype.defaultMessage=function(t,e){return this.messages[t.name]||(this.messages[t.name]={},this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]||(this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]},Validate.prototype.format=function(t,e){return-1!=t.indexOf("{0}")&&(e.constructor!==Array&&(e=[e]),$.each(e,function(e,i){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return i})})),t},Validate.prototype.removeRule=function(t,e){this.rules[t.name]&&this.rules[t.name][e]&&delete this.rules[t.name][e],this.messages[t.name]&&this.messages[t.name][e]&&delete this.messages[t.name][e],this.hideError($(t))},Validate.prototype.setRules=function(t,e){this.rules[t.name]?$.extend(this.rules[t.name],e.rules,!0):this.rules[t.name]=e.rules,this.messages[t.name]?$.extend(this.messages[t.name],e.messages,!0):this.messages[t.name]=e.messages,this.validFields.data[t.name]=$(t)},Validate.prototype.addMethod=function(t,e,i){this.methods[t]=e,this.errorMessages[t]=void 0!==i?i:this.errorMessages[t]},Validate.prototype.errorMessages={required:"该字段不能为空",email:"电子邮箱格式错误",url:"url格式错误",date:"请输入一个有效日期",dateISO:"请输入一个有效日期（ISO）",mobile:"手机号码格式错误",phone:"电话号码格式错误",number:"请输入一个有效的数字",digits:"请输入正整数",minLength:"请输入一个长度不小于{0}个字符的值",maxLength:"请输入一个长度不大于{0}个字符的值",rangeLength:"请输入一个长度介于{0}到{1}个字符的值",min:"请输入一个大于或等于{0}的值",max:"请输入一个小于或等于{0}的值",range:"请输入一个介于{0}到{1}之间的数值",equalTo:"请再输入一个相同的值",remote:"远程验证失败",reg:"格式错误"},Validate.prototype.methods={required:function(t,e){if("select"===e[0].nodeName.toLowerCase()){var i=$.trim(e.val());return i&&i.length>0}return this.checkable(e[0])?this.getLength(t,e[0])>0:$.trim(t).length>0},email:function(t,e){return this.optional(e)||/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}|\d{4}[\/-]\d{1,2}[\/-]\d{1,2}\s\d{1,2}[:]\d{1,2}[:]\d{1,2}\w$/.test(t)},mobile:function(t,e){return this.optional(e)||/^1\d{10}$/.test(t)},phone:function(t,e){return this.optional(e)||/^((0\d{2,3}\-)[1-9]\d{7}(\-\d{1,4})?)$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},minLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o>=i},maxLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||i>=o},rangeLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o>=i[0]&&o<=i[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(t,e,i){var e=$(i);return t===this.elementValue(e)},remote:function(t,e,i){var o,s={},n=this,a=this.previousValue(e[0]);return a.old===t?a.valid:(a.old=t,"string"==typeof i?o=i:(o=i.url,s=i.data),s[e[0].name]=t,s.rnd=Math.random(),$.post(o,s).success(function(t){var i=t===!0||"true"===String(t).toLowerCase();i?n.hideError(e):n.showError(e,a.message),a.valid=i}).error(function(){return!1}),!0)},reg:function(t,e,i){var o=new RegExp(i,"igm");return this.optional(e)||o.test(t)}},Validate.prototype.previousValue=function(t){return $.data(t,"previousValue")||$.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})},Validate.prototype.optional=function(t){var e=this.elementValue(t);return!this.methods.required.call(this,e,t)},Validate.prototype.elementValue=function(t){var e=t.attr("type"),i=t.val();return"radio"===e||"checkbox"===e?$("input[name='"+t.attr("name")+"']:checked").val():"string"==typeof i?i.replace(/\r/g,""):i},Validate.prototype.getLength=function(t,e){switch(e.nodeName.toLowerCase()){case"select":return $("option:selected",e).length;case"input":if(this.checkable(e))return this.$form.find("[name='"+e.name+"']").filter(":checked").length}return t.length},Validate.prototype.getData=function(){var t={},e=this;return e.$form.find("input[name], textarea[name]").each(function(){var e=$(this);if(e.is("[type=checkbox]")===!1&&e.is("[type=radio]")===!1)t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=radio]:checked"))t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=checkbox]:checked")){var i=e.attr("name");t[i]||(t[i]=[]),t[i].push(e.val())}}),t},Validate}),define("km/validateTooltips",["jquery","km/validate","km/tooltips","km/util"],function(t,e,i,o){var s=function(t,i){e.call(this,t,i)};return s.prototype=o.createProto(e.prototype),s.prototype.getTipsPlacement=function(t){var e=t.name,i="right";return this.tipsPlacement||(this.tipsPlacement=this.options.tipsPlacement||{}),this.tipsPlacement[e]?i=this.tipsPlacement[e]:this.tipsPlacement[e]={position:"right",target:t},i},s.prototype.showError=function(e,o){var s;this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var n=this.getTipsPlacement(e[0]);n.target?(s=t(n.target),t.data(e[0],"$target",s)):s=e;var a=i.Get(s);if(a?a.setContent(o):(a=new i(s,{content:o,tipClass:"danger",trigger:"manual",placement:n.position,container:this.options.container||document.body,scrollContainer:this.options.scrollContainer}),i.Set(s,a)),n.checkParents){var r=s.parents(n.checkParents+":eq(0)");r.length>0&&"none"!=r[0].style.display&&(a.show(),s.addClass(this.options.errorClass))}else a.show(),s.addClass(this.options.errorClass)},s.prototype.hideError=function(e,o){"undefined"==typeof o&&(o=!0),this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var s=t.data(e[0],"$target");s&&(e=s);var n=i.Get(e);n&&n.hide(),o&&e.removeClass(this.options.errorClass)},s}),define("km/waterfall",["jquery","km/infiniteScroll","km/popTips"],function(t,e,i){var o=1,s=function(e,i){this.identity=o++,this.$element=e,this.options=t.extend(!0,{$scrollElement:t(window),scrollDistance:0,width:200,left:10,margin:20,nodeTag:"li",resize:!0,url:null,loaded:t.noop,mobilePhone:!1,pageSize:20},i),this.$panel=this.options.$scrollElement,this.$document=t(document),this.loading=!1,this.noMore=!1,this.page=1,this.init()};return s.prototype.init=function(){var t=this;this.options.mobilePhone&&(this.options.width=(this.$panel.width()-this.options.margin)/2),this.arrangementInit(),this.infiniteScroll=new e({$watchElement:this.$element,$scrollElement:this.options.$scrollElement,scrollDistance:this.options.scrollDistance,callback:function(){return t.options.url?void t.remote():void(t.options.data&&t.options.data.length>0&&t.options.loaded.call(t,t.$element,t.options.data))}}),this.options.resize&&this.$panel.on("resize.waterfall."+this.identity,function(){t.arrangementInit()})},s.prototype.arrangementInit=function(){this.arrHeight=[],this.nodes=this.$element.children(this.options.nodeTag);var t=this.$panel.width();if(0!==this.nodes.length){this.options.mobilePhone&&(this.options.width=(t-this.options.margin)/2);var e=parseInt(t/this.options.width),i=e*this.options.width+(e-1)*this.options.left;if(i>t&&(e-=1,i=e*this.options.width+(e-1)*this.options.left),!(i<this.options.width)){this.$element.width(i),this.options.mobilePhone&&this.nodes.width(this.options.width);for(var o,s,n=0;n<this.nodes.length;n++)s=this.nodes.eq(n),o=s.outerHeight(),e>n?(this.arrHeight[n]=o,s.css({top:0,left:n*(this.options.width+this.options.left)})):this.set(s,o);this.adpHeight()}}},s.prototype.arrangement=function(e){var i=this;return 0===this.arrHeight.length?void this.arrangementInit():void(e&&0!==e.length&&(e.each(function(){var e=t(this),o=e.outerHeight();i.set(e,o)}),this.adpHeight()))},s.prototype.set=function(t,e){var i=this.getMinHeight(),o=this.getMinHeightIndex(i);o=-1==o?0:o,this.arrHeight[o]+=e+this.options.left,t.css({top:i+this.options.left,left:o*(this.options.width+this.options.left)})},s.prototype.getMinHeightIndex=function(t){if(Array.indexOf){var e=this.arrHeight.indexOf(t);return e}for(var i=0;i<this.arrHeight.length;i++)if(this.arrHeight[i]===t)return i;return-1},s.prototype.remote=function(){if(!this.noMore&&!this.loading){var e=this;this.loading=!0,t.get(this.options.url,{rnd:Math.random(),page:this.page++,pageSize:this.options.pageSize}).done(function(t){return t&&0!==t.length?(e.options.loaded.call(e,e.$element,t),void(e.loading=!1)):(e.noMore=!0,!1)}).fail(function(){i.error("网络错误！"),e.loading=!1})}},s.prototype.destory=function(){this.infiniteScroll.destory()},s.prototype.imgLoad=function(t,e,i){var o=new Image,s=this;o.onload=function(){t.attr("src",e),i(s.zoom(o.width,o.height))},o.onerror=function(){i({width:s.options.width,height:300})},o.src=e},s.prototype.zoom=function(t,e){var i;return t>e||t==e?(i=t/e,e=this.options.width/i):(i=e/t,e=this.options.width*i),{width:this.options.width,height:e}},s.prototype.getMinHeight=function(){return Math.min.apply(null,this.arrHeight)},s.prototype.getMaxHeight=function(){return Math.max.apply(null,this.arrHeight)},s.prototype.adpHeight=function(){this.$element.height(this.getMaxHeight())},s}),define("km/window",["jquery","km/dragdrop","km/popTips","km/loading","km/util"],function($,DragDrop,popTips,Loading,util){var Window=function(t){this.options=$.extend(!0,{id:null,url:null,params:null,title:"弹出框",content:null,width:"600",height:null,backdrop:!0,backdropClose:!1,iframe:!1,appendTo:document.body,showFooter:!0,borderRadius:"6px",space:50,fontClass:".fa,.glyphicon,.e-icon",fontRedrawDelay:500,btns:[]},t),0==this.options.btns.length&&(this.options.btns=[{text:"确定",className:"k-btn-primary",action:"ok"},{text:"取消",className:"k-btn-default",action:"close"}]),this._event={open:$.noop,ok:$.noop,close:$.noop,afterClose:$.noop},this.identity=this.options.id||ids.get(),this.isClose=!0,this.loading=!1,this.template='<div class="k-window" id="k-window-'+this.identity+'"><h4 class="k-window-header"><span class="k-window-title"></span><span class="k-window-close" role="kwin_close">×</span></h4><div class="k-window-container"></div><div class="k-window-footer"></div></div>',this.backdrop='<div class="k-window-backdrop"></div>',this.$document=$(document),this.$window=$(window),this.init()};Window.prototype.init=function(){this.build(),this.setTitle(this.options.title),this.options.iframe?(this.$container.css({padding:0,overflowY:"hidden"}).append('<iframe frameborder="0" width="100%" src="about:blank" scrolling="auto"></iframe>'),this.$iframe=this.$container.find("iframe")):this.setContent(this.options.content),this.eventBind()},Window.prototype.eventBind=function(){var t=this;if(this.$window.on("resize.window."+this.identity,function(){t.tm&&clearTimeout(t.tm),t.tm=setTimeout(function(){t.layout()},300)}),this.$backdrop.on("click.window",function(){t.options.backdropClose&&t.close()}),this.$win.on("click.window","[role=kwin_close],[role=kwin_cancel]",function(){t._event.close.call(t)!==!1&&t.close()}).on("click.window","[role=kwin_ok]",function(){t._event.ok.call(t)!==!1&&t.close()}),this.options.btns&&this.options.btns.length>0)for(var e,i,o=0;o<this.options.btns.length;o++)e=this.options.btns[o],i=e.action.toLowerCase(),"ok"!=i&&"cancel"!=i&&"close"!=i&&!function(t,e,i){i.$win.off("click.window","[role=kwin_"+e+"]").on("click.window","[role=kwin_"+e+"]",function(){t.func&&t.func.call(i,i.$iframe)!==!1&&i.close()})}(e,i,this)},Window.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Window.prototype.setTitle=function(t){this.$header.find(".k-window-title").text(t)},Window.prototype.setContent=function(t){t=t||this.options.content,this.$container.html(t)},Window.prototype.setSize=function(t){this.options.width=t.width,this.options.height=t.height,this.$win.css(t)},Window.prototype.remote=function(){if("string"==typeof this.options.url&&null==this.options.content&&!this.options.iframe){var t=this,e=$.Deferred();return this.loading=!0,this.$container.load(this.options.url+"?rnd="+Math.random(),this.options.params,function(){t.loading=!1,e.resolve()}),e.promise()}},Window.prototype.open=function(){var t=this;this.show(),this.$footer.hide(),this.loadingShow(),$.when(this.remote()).done(function(){if(t.options.iframe){t.$iframe.attr("src","about:blank");var e=t.options.url;e+=-1!=e.indexOf("?")?"&rand="+Math.random():"?rand="+Math.random(),setTimeout(function(){t.$iframe.attr("src",e).show(),util.isIE8()&&($("head").append('<style id="iconfontfix" type="text/css">:before,:after{content:none!important}</style>'),setTimeout(function(){$("#iconfontfix").remove()})),t.bindIframeLoad||t.$iframe.on("load",function(){var e=t.$iframe.attr("src");"about:blank"!=e&&(t.iframeTm&&clearTimeout(t.iframeTm),t.bindIframeLoad=!0,t.options.showFooter&&t.$footer.show(),t.loadingHide())})},50)}else t.options.showFooter&&t.$footer.show(),t.loadingHide()}).fail(function(){t.loadingHide()}).always(function(){})},Window.prototype.close=function(t){var e=this;this.isClose=!0,this.$win.css({left:"-900px",top:"-900px"}),this.$backdrop.hide(),zIndex.pop(),this._event.afterClose.call(e),this.loadingHide(),this.options.iframe&&setTimeout(function(){e.$iframe.hide()},500)},Window.prototype.show=function(){this.isClose=!1,this.$win.show(),this.options.backdrop&&this.$backdrop.show(),this._event.open(this.$win);var t=zIndex.get();this.$win.css("zIndex",t),this.$backdrop.css("zIndex",--t),this.layout()},Window.prototype.layout=function(){if(!this.isClose){var t,e,i=this.$window.height(),o=i-this.options.space,s=this.$header.height(),n=this.options.showFooter?this.$footer.height():4,a=o-s-n;this.options.height?o<this.options.height?(t=o,e=a):(t=this.options.height,e=t-s-n):(this.orgHeight=this.orgHeight||this.$win.height(),o<this.orgHeight?(t=o,e=a):(t=this.orgHeight,e=this.orgHeight-s-n)),this.$container.css("height",e),this.options.iframe&&this.$container.find("iframe").height(e),this.$win.css({left:"50%",top:"50%",height:t,marginLeft:-this.options.width/2,marginTop:-t/2})}},Window.prototype.build=function(){if(this.$win=$(this.template).css({width:this.options.width,height:this.options.height,borderRadius:this.options.borderRadius}),$.data(this.$win[0],"window",this),this.$backdrop=$(this.backdrop),this.$header=this.$win.find(".k-window-header"),this.$container=this.$win.find(".k-window-container"),this.$footer=this.$win.find(".k-window-footer"),this.$btnBox=this.$footer.find(".k-btn-box"),this.$appendBtnBox=this.$footer.find(".append-btn-box"),this.$insertBtnBox=this.$footer.find(".insert-btn-box"),this.$win.appendTo(this.options.appendTo),this.$backdrop.appendTo(this.options.appendTo),this.options.showFooter||this.$footer.hide(),this.options.btns&&this.options.btns.length>0){this.$footer.find(".k-btn-inner").hide();var t=this.getBtnHtml(this.options.btns);this.$footer.append(t)}},Window.prototype.setBtns=function(t){if(this.$footer.find(".k-btn-inner").show().end().find(".k-btn-custom").remove(),t&&0!=t.length){this.$footer.find(".k-btn-inner").hide().end().append(this.getBtnHtml(t,!0));for(var e,i,o=0;o<t.length;o++)e=t[o],i=e.action.toLowerCase(),"ok"!=i&&"close"!=i&&"cancel"!=i&&!function(t,e,i){i.$win.off("click.window","[role=kwin_"+e+"]").on("click.window","[role=kwin_"+e+"]",function(){t.func&&t.func.call(i,i.$iframe)!==!1&&i.close()})}(e,i,this)}},Window.prototype.getBtnHtml=function(t,e){for(var i,o,s,n,a=[],r=0;r<t.length;r++)i=t[r],o=i.action.toLowerCase(),s=i.className,n="k-btn-custom","ok"==o&&(n=e?n:"k-btn-inner",s||(s="k-btn-primary")),"close"!=o&&"cancel"!=o||(n=e?n:"k-btn-inner",s||(s="k-btn-default")),a.push('<button type="button" class="k-btn '+(s||"k-btn-primary")+" "+n+' " role="kwin_'+("cancel"==o?"close":o)+'">'+i.text+"</button>");return a.join("")},Window.prototype.loadingShow=function(){this.$container.addClass("k-window-loading")},Window.prototype.loadingHide=function(){this.$container.removeClass("k-window-loading")},Window.alert=function(t,e,i){$.isFunction(e)&&(i=e,e=t,t="提示");var o=window.winAlert;o||(o=new Window({width:400,backdropClose:!1}),o.$win.find(".window-cancel").hide(),window.winAlert=o),o.$win.find("button[role=kwin_close]").hide(),o.setTitle(t),o.setContent(e),o.on("ok",i||$.noop),o.open()},Window.confirm=function(t,e,i,o){$.isFunction(e)&&(o=i,i=e,e=t,t="确认提示");var s=window.winConfirm;s||(s=new Window({width:400,backdropClose:!1}),window.winConfirm=s),s.setTitle(t),s.setContent(e),s.on("ok",i||$.noop),s.on("close",o||$.noop),s.open()},Window.close=function(t){$win=$("#k-window-"+t);var e=$.data($win[0],"window");e&&e.close(!0)},Window.open=function(t){var e=new Window(t);return e.open(),e},Window.Global=function($elms){$elms=$elms||$("[data-module=window]"),$elms.each(function(){var $elm=$(this),options=$elm.attr("data-options"),url=$elm.attr("data-url"),width=$elm.attr("data-width"),height=$elm.attr("data-height"),iframe=$elm.attr("data-iframe"),title=$elm.attr("data-title")||"模态窗口",content=$elm.attr("data-content"),showFooter=$elm.attr("data-showFooter"),buttons=$elm.attr("data-btns"),onOk=$elm.attr("data-onOk"),onClose=$elm.attr("data-onClose"),onAfterClose=$elm.attr("data-onAfterClose"),data=$.data($elm[0],"window");data||(onOk=onOk&&onOk.length>0?eval("(0,"+onOk+")"):$.noop,onClose=onClose&&onClose.length>0?eval("(0,"+onClose+")"):$.noop,onAfterClose=onAfterClose&&onAfterClose.length>0?eval("(0,"+onAfterClose+")"):$.noop,options=options&&options.length>0?eval("(0,"+options+")"):{url:url,title:title,content:content,width:width&&width.length>0?parseInt(width):680,height:height&&height.length>0?parseInt(height):480,showFooter:!showFooter||"false"!=showFooter,iframe:!iframe||"false"!=iframe,btns:buttons&&buttons.length>0?eval("(0,"+buttons+")"):[]},data=new Window(options),data.on("ok",function(){return onOk.call(this)}).on("close",function(){return onClose.call(this)}).on("afterClose",function(){return onAfterClose.call(this)}),$elm.parent(".k-input-group").off("click.window","button").on("click.window","button",function(){data.open()}),$elm.on("click.window",function(){data.open()}),$.data($elm[0],"window",data))})};var zIndex=function(){var t=[];return{get:function(){var e;return 0===t.length?(e=1e3,t.push(e)):(e=t[t.length-1],e+=2,t.push(e)),e},pop:function(){0!==t.length&&t.pop()}}}(),ids=function(){var t=[];return{get:function(){var e;return 0==t.length?(e=1,t.push(e)):(e=t[t.length-1],e+=1,t.push(e)),e}}}();return Window}),define("km/wordLimit",["jquery"],function($){var WordLimit=function(t,e){this.$element=t,this.options=$.extend(!0,{maxLength:140,feedback:".chars"},e),this.init()};return WordLimit.prototype.init=function(){var t=this;this.maxLength=parseInt(this.$element.attr("maxLength")||this.options.maxLength),this.$feedback=$(this.options.feedback),this.$element.on("keyup.wordlimit",function(){var e=$.trim($(this).val());t.update(e)}),this.update($.trim(this.$element.val()))},WordLimit.prototype.update=function(t){var e=t.length,i=this.maxLength,o=i-e;e>=i&&this.$element.val(t.substring(0,i)),this.$feedback.html(0>o?0:o)},WordLimit.prototype.reset=function(){this.$element.val(""),this.$feedback.html(this.options.maxLength)},WordLimit.Global=function($elements){$elements=$elements||$("input,textarea").filter('[data-module="wordlimit"]'),$elements.each(function(){var $this=$(this),options=$this.attr("data-options"),maxLength=$this.attr("maxLength"),wordLimit=WordLimit.Get($this);options=options&&options.length>0?eval("(0,"+options+")"):{maxLength:maxLength,feedback:$this.attr("data-feedback")},wordLimit||(wordLimit=new WordLimit($this,options),WordLimit.Set($this,wordLimit))})},WordLimit.Get=function(t){return $.data(t[0],"wordLimit")},WordLimit.Set=function(t,e){$.data(t[0],"wordLimit",e)},WordLimit.Reset=function(t){t=t||$("input,textarea").filter('[data-module="wordlimit"]'),t.each(function(){var t=WordLimit.Get($(this));t&&t.reset()})},WordLimit}),define("KM",["km/ajax","km/app","km/areaSelector","km/autoComplete","km/cache","km/clipZoom","km/contextMenu","km/datePicker","km/dragdrop","km/dropDownList","km/dropDownTree","km/event","km/focusMap","km/highlight","km/imgPreview","km/infiniteScroll","km/layout","km/lazyload","km/loading","km/magnifier","km/mask","km/pager","km/panel","km/placeholder","km/popover","km/popTips","km/portlets","km/rating","km/resizable","km/router","km/scrollImg","km/slider","km/switch","km/tab","km/tagSelector","km/template","km/tooltips","km/tree","km/treeTable","km/upload","km/util","km/validate","km/validateTooltips","km/waterfall","km/window","km/wordLimit"],function(t,e,i,o,s,n,a,r,h,l,p,d,c,u,f,m,g,$,v,w,y,b,k,x,C,T,I,S,D,P,z,L,_,N,H,F,E,W,B,M,R,j,O,A,U,q){return window.KM={ajax:t,App:e,areaSelector:i,autoComplete:o,cache:s,ClipZoom:n,contextMenu:a,DatePicker:r,Dragdrop:h,DropDownList:l,DropDownTree:p,event:d,focusMap:c,highlight:u,imgPreview:f,InfiniteScroll:m,Layout:g,lazyload:$,Loading:v,magnifier:w,Mask:y,Pager:b,Panel:k,placeholder:x,Popover:C,popTips:T,portlets:I,Rating:S,Resizable:D,Router:P,scrollImg:z,slider:L,Switch:_,Tab:N,tagSelector:H,Template:F,Tooltips:E,Tree:W,TreeTable:B,Upload:M,Util:R,Validate:j,ValidateTooltips:O,Waterfall:A,Window:U,WordLimit:q}});